{
  "updatedAt": "2025-12-03T01:00:45.665Z",
  "createdAt": "2025-12-03T00:20:08.855Z",
  "id": "N7S3NbfkeKCZg5q9",
  "name": "Sheet Collaborator",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sheet-write",
        "responseMode": "responseNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "GET, POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type"
              }
            ]
          }
        }
      },
      "id": "webhook-trigger",
      "name": "Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        260,
        300
      ],
      "webhookId": "sheet-write"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "append",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "append"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "read",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "read"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "init",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "init"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.action }}",
                    "rightValue": "update",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "update"
            }
          ]
        },
        "options": {}
      },
      "id": "switch-action",
      "name": "Route by Action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        480,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "// Get the incoming data\nconst body = $input.first().json.body;\nconst tab = body.tab;\nconst data = body.data;\n\n// Define column mappings for each tab\nconst columnMappings = {\n  'saas_costs': ['Service', 'Description', 'Monthly Cost', 'Notes'],\n  'variable_costs': ['Action', 'Cost Per Unit', 'Unit Type', 'Notes'],\n  'labor': ['Activity', 'Who', 'Hours/Month', 'Rate', 'Notes'],\n  'pricing': ['Item', 'Type', 'Price', 'Cost', 'Margin', 'Notes']\n};\n\n// Get the columns for this tab\nconst columns = columnMappings[tab] || Object.keys(data);\n\n// Build the row object\nconst row = {};\nfor (const col of columns) {\n  row[col] = data[col] || '';\n}\n\nreturn {\n  json: {\n    ...row,\n    _sheet_id: body.sheet_id,\n    _tab: tab\n  }\n};"
      },
      "id": "prepare-row",
      "name": "Prepare Row Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        200
      ]
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "={{ $json._sheet_id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json._tab }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [],
          "schema": []
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "append-row",
      "name": "Append Row",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        920,
        200
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "MmkEFg1TuHDH32HZ",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": {
          "__rl": true,
          "value": "={{ $json.body.sheet_id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json.body.tab }}",
          "mode": "name"
        },
        "options": {}
      },
      "id": "read-rows",
      "name": "Read Rows",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        700,
        400
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "MmkEFg1TuHDH32HZ",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, action: 'append', tab: $json._tab, message: 'Row added successfully' }) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-append",
      "name": "Respond Append",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1140,
        200
      ]
    },
    {
      "parameters": {
        "respondWith": "allEntries",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-read",
      "name": "Respond Read",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        920,
        400
      ]
    },
    {
      "parameters": {
        "jsCode": "// Initialize sheet with all tabs and headers\nconst body = $input.first().json.body;\nconst sheetId = body.sheet_id;\n\n// Define all tabs and their headers\nconst tabConfigs = [\n  { name: 'saas_costs', headers: ['Service', 'Description', 'Monthly Cost', 'Notes'] },\n  { name: 'variable_costs', headers: ['Action', 'Cost Per Unit', 'Unit Type', 'Notes'] },\n  { name: 'labor', headers: ['Activity', 'Who', 'Hours/Month', 'Rate', 'Notes'] },\n  { name: 'pricing', headers: ['Item', 'Type', 'Price', 'Cost', 'Margin', 'Notes'] }\n];\n\n// Output each tab config for processing\nreturn tabConfigs.map(config => ({\n  json: {\n    _sheet_id: sheetId,\n    _tab_name: config.name,\n    _headers: config.headers\n  }\n}));"
      },
      "id": "prepare-init",
      "name": "Prepare Init Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        600
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://sheets.googleapis.com/v4/spreadsheets/{{ $json._sheet_id }}:batchUpdate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ requests: [{ addSheet: { properties: { title: $json._tab_name } } }] }) }}",
        "options": {}
      },
      "id": "create-tab",
      "name": "Create Tab",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        920,
        600
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "MmkEFg1TuHDH32HZ",
          "name": "Google Sheets account 2"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "={{ $json._sheet_id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json._tab_name }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {},
          "matchingColumns": [],
          "schema": []
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "add-headers",
      "name": "Add Headers",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        1140,
        600
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "MmkEFg1TuHDH32HZ",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, action: 'init', message: 'Tabs created with headers', tabs: ['saas_costs', 'variable_costs', 'labor', 'pricing'] }) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-init",
      "name": "Respond Init",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1360,
        600
      ]
    },
    {
      "parameters": {
        "jsCode": "// Prepare update data\nconst body = $input.first().json.body;\nconst tab = body.tab;\nconst rowIndex = body.row_index;\nconst data = body.data;\n\n// Define column mappings for each tab\nconst columnMappings = {\n  'saas_costs': ['Service', 'Description', 'Monthly Cost', 'Notes'],\n  'variable_costs': ['Action', 'Cost Per Unit', 'Unit Type', 'Notes'],\n  'labor': ['Activity', 'Who', 'Hours/Month', 'Rate', 'Notes'],\n  'pricing': ['Item', 'Type', 'Price', 'Cost', 'Margin', 'Notes']\n};\n\n// Get the columns for this tab\nconst columns = columnMappings[tab] || Object.keys(data);\n\n// Build the row object\nconst row = { row_number: rowIndex };\nfor (const col of columns) {\n  if (data[col] !== undefined) {\n    row[col] = data[col];\n  }\n}\n\nreturn {\n  json: {\n    ...row,\n    _sheet_id: body.sheet_id,\n    _tab: tab\n  }\n};"
      },
      "id": "prepare-update",
      "name": "Prepare Update Data",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        700,
        800
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "={{ $json._sheet_id }}",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "={{ $json._tab }}",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {},
          "matchingColumns": [
            "row_number"
          ],
          "schema": []
        },
        "options": {
          "cellFormat": "USER_ENTERED"
        }
      },
      "id": "update-row",
      "name": "Update Row",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        920,
        800
      ],
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "MmkEFg1TuHDH32HZ",
          "name": "Google Sheets account 2"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({ success: true, action: 'update', tab: $json._tab, message: 'Row updated successfully' }) }}",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              }
            ]
          }
        }
      },
      "id": "respond-update",
      "name": "Respond Update",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        1140,
        800
      ]
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Route by Action",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Route by Action": {
      "main": [
        [
          {
            "node": "Prepare Row Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Read Rows",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Init Data",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Prepare Update Data",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Row Data": {
      "main": [
        [
          {
            "node": "Append Row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Append Row": {
      "main": [
        [
          {
            "node": "Respond Append",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Read Rows": {
      "main": [
        [
          {
            "node": "Respond Read",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Init Data": {
      "main": [
        [
          {
            "node": "Create Tab",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Tab": {
      "main": [
        [
          {
            "node": "Add Headers",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Add Headers": {
      "main": [
        [
          {
            "node": "Respond Init",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Update Data": {
      "main": [
        [
          {
            "node": "Update Row",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Row": {
      "main": [
        [
          {
            "node": "Respond Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "versionId": "541418de-cc88-4125-b8b2-5f3413105b2c",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-12-03T00:20:08.857Z",
      "createdAt": "2025-12-03T00:20:08.857Z",
      "role": "workflow:owner",
      "workflowId": "N7S3NbfkeKCZg5q9",
      "projectId": "bll44iFOa92qb20Q"
    }
  ],
  "tags": []
}