{
  "updatedAt": "2026-02-09T03:17:32.018Z",
  "createdAt": "2026-01-29T15:03:42.069Z",
  "id": "3ds9Y97qpRjTI63Y",
  "name": "[GENERATE] Platform Copy",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "generate-platform-copy",
        "responseMode": "responseNode",
        "options": {
          "allowedOrigins": "*"
        }
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000001",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        208,
        304
      ],
      "webhookId": "generate-platform-copy"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT id, industry_id FROM clients WHERE id = '{{ $json.body.client_id }}'::uuid",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000002",
      "name": "Fetch Client",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        400,
        304
      ],
      "credentials": {
        "postgres": {
          "id": "ZUwzqy3kvUJpXrDM",
          "name": "Postgres (Dev)"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT prompt_type, prompt_content FROM client_prompts WHERE client_id = '{{ $(\"Fetch Client\").first().json.id }}'::uuid",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000003",
      "name": "Fetch Client Prompts",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        608,
        208
      ],
      "credentials": {
        "postgres": {
          "id": "ZUwzqy3kvUJpXrDM",
          "name": "Postgres (Dev)"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT prompt_type, platform, content_type, prompt_content FROM client_copy_prompts WHERE client_id = '{{ $(\"Fetch Client\").first().json.id }}'::uuid",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000004",
      "name": "Fetch Client Copy Prompts",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        608,
        400
      ],
      "credentials": {
        "postgres": {
          "id": "ZUwzqy3kvUJpXrDM",
          "name": "Postgres (Dev)"
        }
      },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// Extract platforms from input\nconst input = $(\"Webhook Trigger\").item.json.body;\nconst platforms = input.platforms || [\"meta\"];\n\n// Return one item per platform for the loop\nreturn platforms.map(platform => ({\n  json: {\n    platform,\n    ...input\n  }\n}));"
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000005",
      "name": "Split by Platform",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        304
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT platform, content_type, prompt_content FROM industry_copy_prompts WHERE industry_id = '{{ $(\"Fetch Client\").first().json.industry_id }}'::uuid AND platform = '{{ $json.platform }}' AND content_type = '{{ $json.content_type }}'",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000006",
      "name": "Fetch Industry Copy Prompt",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1008,
        304
      ],
      "credentials": {
        "postgres": {
          "id": "ZUwzqy3kvUJpXrDM",
          "name": "Postgres (Dev)"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// ═══════════════════════════════════════════════════════════════\n// PLATFORM COPY GENERATOR - PROMPT ASSEMBLER\n// ═══════════════════════════════════════════════════════════════\n\n// $json contains the output from Fetch Industry Copy Prompt for THIS item\nconst input = $json;\nconst { platform, content_type, template_type, format, theme, vehicles, script, prompt_content } = input;\n\n// Get data from other nodes (these are the same for all platforms)\nconst clientPromptsAll = $('Fetch Client Prompts').all();\nconst clientCopyPromptsAll = $('Fetch Client Copy Prompts').all();\n\n// Parse JSONB if needed\nconst parseJsonb = (val) => {\n  if (!val) return {};\n  if (typeof val === 'string') {\n    try { return JSON.parse(val); } catch { return {}; }\n  }\n  return val;\n};\n\n// The industry prompt comes directly from the current item ($json)\nconst industryPrompt = parseJsonb(prompt_content);\n\nconst clientBase = parseJsonb(clientPromptsAll.find(r => r.json.prompt_type === 'base')?.json?.prompt_content);\nconst clientRules = parseJsonb(clientPromptsAll.find(r => r.json.prompt_type === 'rules')?.json?.prompt_content) || [];\nconst clientCopyBase = parseJsonb(clientCopyPromptsAll.find(r => r.json.prompt_type === 'base')?.json?.prompt_content);\nconst clientCopyOverride = parseJsonb(clientCopyPromptsAll.find(r => \n  r.json.prompt_type === 'override' && \n  r.json.platform === platform && \n  r.json.content_type === content_type\n)?.json?.prompt_content);\n\n// Deep merge helper\nfunction deepMerge(target, ...sources) {\n  for (const source of sources) {\n    if (!source) continue;\n    for (const key of Object.keys(source)) {\n      if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {\n        target[key] = deepMerge(target[key] || {}, source[key]);\n      } else {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n}\n\n// Merge all layers: industry < client copy base < client copy override\nconst mergedConfig = deepMerge(\n  {},\n  industryPrompt,\n  clientCopyBase,\n  clientCopyOverride\n);\n\n// Build final prompt context - return single item (mode is runOnceForEachItem)\nreturn {\n  platform,\n  content_type,\n  format: format || 'video',\n  template_type,\n  theme,\n  vehicles,\n  script,\n  \n  // Merged config for this platform + content_type\n  platform_config: mergedConfig,\n  \n  // Client identity\n  client: {\n    name: clientBase?.identity?.business_name,\n    location: clientBase?.identity?.location,\n    contact_name: clientCopyBase?.contact?.contact_name,\n    phone: clientCopyBase?.contact?.phone,\n    phone_display: clientCopyBase?.contact?.phone_display,\n    location_display: clientCopyBase?.location?.with_emoji\n  },\n  \n  // Client rules\n  rules: Array.isArray(clientRules) ? clientRules : [],\n  \n  // Hashtags (merged)\n  hashtags: {\n    always: clientCopyBase?.hashtags?.always_include || [],\n    local: clientCopyBase?.hashtags?.local || [],\n    industry: mergedConfig?.hashtags?.examples || [],\n    avoid: mergedConfig?.hashtags?.avoid || []\n  }\n};"
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000007",
      "name": "Assemble Copy Context",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1200,
        304
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Build the system prompt based on platform\nconst ctx = $json;\nconst platform = ctx.platform;\nconst contentType = ctx.content_type;\nconst config = ctx.platform_config || {};\n\n// Webhook input\n// This gets the first item from that node regardless of pairing\nconst input = $('Split by Platform').first().json;\n\n\nlet systemPrompt = `You are an expert social media copywriter for local businesses.\n\nPLATFORM: ${platform.toUpperCase()}\nCONTENT TYPE: ${contentType.toUpperCase()}\n\n`;\n\n// Add critical rules for organic\nif (contentType === 'organic' && config.critical_rules) {\n  systemPrompt += `CRITICAL RULES (violating these = content suppression):\\n`;\n  config.critical_rules.forEach(rule => {\n    systemPrompt += `- ${rule}\\n`;\n  });\n  systemPrompt += `\\n`;\n}\n\n// Add tone\nif (config.tone) {\n  systemPrompt += `TONE: ${config.tone}\\n\\n`;\n}\n\n// Platform-specific structure\nif (platform === 'meta') {\n  systemPrompt += `OUTPUT FORMAT (JSON):\n{\n  \"primary_text\": \"<your copy here with line breaks as \\\\n>\",\n  \"headline\": \"<40 chars max, punchy>\",\n  \"description\": \"<30 chars max>\"\n}\\n\\n`;\n  \n  if (config.primary_text) {\n    systemPrompt += `PRIMARY TEXT RULES:\\n`;\n    systemPrompt += `- Structure: ${(config.primary_text.structure || []).join(' → ')}\\n`;\n    systemPrompt += `- Max ${config.primary_text.max_chars_before_fold || 125} chars before \"See more\" fold\\n`;\n    if (config.primary_text.emojis) systemPrompt += `- Emojis: ${config.primary_text.emojis}\\n`;\n    systemPrompt += `\\n`;\n  }\n  if (config.headline) {\n    systemPrompt += `HEADLINE RULES:\\n`;\n    systemPrompt += `- Max ${config.headline.max_chars || 40} chars\\n`;\n    systemPrompt += `- Style: ${config.headline.style || 'Punchy'}\\n`;\n    if (config.headline.avoid) systemPrompt += `- Avoid: ${config.headline.avoid.join(', ')}\\n`;\n    systemPrompt += `\\n`;\n  }\n} else if (platform === 'tiktok') {\n  systemPrompt += `OUTPUT FORMAT (JSON):\n{\n  \"caption\": \"<your caption here>\",\n  \"hashtags\": [\"#tag1\", \"#tag2\", ...]\n}\\n\\n`;\n  \n  if (config.caption) {\n    systemPrompt += `CAPTION RULES:\\n`;\n    systemPrompt += `- Max ${config.caption.max_chars || 150} characters\\n`;\n    systemPrompt += `- Style: ${config.caption.style || 'casual, trendy'}\\n`;\n    systemPrompt += `\\n`;\n  }\n  if (config.hooks) {\n    systemPrompt += `GOOD HOOKS: ${(config.hooks.good || []).join(', ')}\\n`;\n    systemPrompt += `AVOID: ${(config.hooks.avoid || []).join(', ')}\\n\\n`;\n  }\n} else if (platform === 'youtube') {\n  systemPrompt += `OUTPUT FORMAT (JSON):\n{\n  \"title\": \"<60 chars max>\",\n  \"description\": \"<full description>\",\n  \"tags\": [\"tag1\", \"tag2\", ...]\n}\\n\\n`;\n  if (config.title) {\n    systemPrompt += `TITLE RULES:\\n`;\n    systemPrompt += `- Max ${config.title.max_chars || 60} chars\\n`;\n    if (config.title.style) systemPrompt += `- Style: ${config.title.style}\\n`;\n    systemPrompt += `\\n`;\n  }\n}\n\n// Add terminology guidance\nif (config.terminology) {\n  if (config.terminology.prefer?.length) {\n    systemPrompt += `PREFERRED WORDS: ${config.terminology.prefer.join(', ')}\\n`;\n  }\n  if (config.terminology.avoid?.length) {\n    systemPrompt += `AVOID WORDS: ${config.terminology.avoid.join(', ')}\\n`;\n  }\n  systemPrompt += `\\n`;\n}\n\n// Build user prompt\nlet userPrompt = '';\n\nif (input.script) {\n  userPrompt += `VIDEO SCRIPT:\\n\"\"\"\\n${input.script}\\n\"\"\"\\n\\nWrite copy that complements this script. Reference the specific vehicles and benefits mentioned.\\n\\n`;\n}\n\nif (input.theme) {\n  userPrompt += `THEME: ${input.theme}\\n\\n`;\n}\n\nif (ctx.vehicles && ctx.vehicles.length) {\n  userPrompt += `FEATURED VEHICLES:\\n`;\n  ctx.vehicles.forEach(v => {\n    userPrompt += `- ${v.year || ''} ${v.make || ''} ${v.model || ''}${v.price ? ' - $' + v.price : ''}\\n`;\n  });\n  userPrompt += `\\n`;\n}\n\n// Add client info for contact/location\nif (ctx.client?.phone_display) {\n  userPrompt += `CONTACT: ${ctx.client.phone_display}\\n`;\n}\nif (ctx.client?.location_display) {\n  userPrompt += `LOCATION: ${ctx.client.location_display}\\n`;\n}\n\n// Add hashtag guidance\nif (platform !== 'youtube') {\n  if (ctx.hashtags?.always?.length) {\n    userPrompt += `\\nHASHTAGS TO INCLUDE: ${ctx.hashtags.always.join(', ')}\\n`;\n  }\n  if (ctx.hashtags?.local?.length) {\n    userPrompt += `LOCAL HASHTAGS: ${ctx.hashtags.local.join(', ')}\\n`;\n  }\n  if (ctx.hashtags?.avoid?.length) {\n    userPrompt += `AVOID THESE HASHTAGS: ${ctx.hashtags.avoid.join(', ')}\\n`;\n  }\n}\n\nuserPrompt += `\\nGenerate the ${platform} ${contentType} copy now. Return ONLY valid JSON, no markdown.`;\n\nreturn {\n  ...ctx,\n  system_prompt: systemPrompt,\n  user_prompt: userPrompt\n};"
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000008",
      "name": "Build AI Prompts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1408,
        304
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            },
            {
              "name": "content-type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "claude-sonnet-4-20250514"
            },
            {
              "name": "max_tokens",
              "value": "={{1024}}"
            },
            {
              "name": "system",
              "value": "={{$json.system_prompt || \"\"}}"
            },
            {
              "name": "messages",
              "value": "={{ [{\"role\": \"user\", \"content\": $json.user_prompt}] }}"
            }
          ]
        },
        "options": {
          "timeout": 60000
        }
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000009",
      "name": "Generate Copy (Claude)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1600,
        304
      ],
      "credentials": {
        "anthropicApi": {
          "id": "Cias5aAJewPKMMCa",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Get context from current item (mode is runOnceForEachItem)\n// Previous nodes pass data through, so we look at Build AI Prompts for context\nconst prevData = $('Build AI Prompts').item.json;\nconst claudeResponse = $json;\n\nlet generatedCopy;\ntry {\n  let content = claudeResponse.content?.[0]?.text || '';\n  content = content.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n  generatedCopy = JSON.parse(content);\n} catch (e) {\n  return {\n    error: 'Failed to parse: ' + e.message,\n    platform: prevData.platform,\n    content_type: prevData.content_type\n  };\n}\n\n// Normalize TikTok hashtags to array if returned as string\nif (prevData.platform === 'tiktok' && generatedCopy.hashtags) {\n  if (typeof generatedCopy.hashtags === 'string') {\n    generatedCopy.hashtags = generatedCopy.hashtags\n      .split(/[,\\s]+/)\n      .map(h => h.trim())\n      .filter(h => h.startsWith('#'));\n  }\n}\n\nconst warnings = [];\nconst charCounts = {};\n\nif (prevData.platform === 'meta') {\n  if (generatedCopy.primary_text) {\n    charCounts.primary_text = generatedCopy.primary_text.length;\n    const firstLine = generatedCopy.primary_text.split('\\n')[0];\n    charCounts.primary_before_fold = firstLine.length;\n    if (firstLine.length > 125) warnings.push('Primary text first line: ' + firstLine.length + ' chars (125 max)');\n  }\n  if (generatedCopy.headline) {\n    charCounts.headline = generatedCopy.headline.length;\n    if (generatedCopy.headline.length > 40) warnings.push('Headline: ' + generatedCopy.headline.length + ' chars (40 max)');\n  }\n  if (generatedCopy.description) {\n    charCounts.description = generatedCopy.description.length;\n    if (generatedCopy.description.length > 30) warnings.push('Description: ' + generatedCopy.description.length + ' chars (30 max)');\n  }\n} else if (prevData.platform === 'tiktok') {\n  if (generatedCopy.caption) {\n    charCounts.caption = generatedCopy.caption.length;\n    if (generatedCopy.caption.length > 150) warnings.push('Caption: ' + generatedCopy.caption.length + ' chars (150 max)');\n  }\n}\n\nreturn {\n  platform: prevData.platform,\n  content_type: prevData.content_type,\n  format: prevData.format || 'video',\n  copy: generatedCopy,\n  char_counts: charCounts,\n  warnings,\n  client_id: prevData.client_id,\n  video_request_id: prevData.video_request_id,\n  plan_asset_id: prevData.plan_asset_id\n};"
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000010",
      "name": "Validate Char Counts",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1808,
        304
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO generated_copy (video_request_id, plan_asset_id, platform, content_type, format, copy_content) VALUES ({{ $json.video_request_id ? \"'\" + $json.video_request_id + \"'::uuid\" : \"NULL\" }}, {{ $json.plan_asset_id ? \"'\" + $json.plan_asset_id + \"'::uuid\" : \"NULL\" }}, '{{ $json.platform }}', '{{ $json.content_type }}', '{{ $json.format }}', '{{ JSON.stringify({ copy: $json.copy, char_counts: $json.char_counts, warnings: $json.warnings }).replace(/'/g, \"''\") }}'::jsonb) RETURNING id, platform, content_type",
        "options": {}
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000011",
      "name": "Store Generated Copy",
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2112,
        208
      ],
      "credentials": {
        "postgres": {
          "id": "ZUwzqy3kvUJpXrDM",
          "name": "Postgres (Dev)"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Aggregate all generated copy for response\nconst allCopy = $('Validate Char Counts').all();\n\n// Check if we have stored results or skipped storage\nlet storedResults = [];\ntry {\n  storedResults = $('Store Generated Copy').all();\n} catch (e) {\n  // Storage was skipped\n}\n\nlet skipResults = [];\ntry {\n  skipResults = $('Skip Storage').all();\n} catch (e) {\n  // Storage was not skipped\n}\n\nconst results = allCopy.map((item, i) => ({\n  platform: item.json.platform,\n  content_type: item.json.content_type,\n  copy: item.json.copy,\n  char_counts: item.json.char_counts,\n  warnings: item.json.warnings,\n  stored_id: storedResults[i]?.json?.id || skipResults[i]?.json?.stored_id || null\n}));\n\nreturn {\n  success: true,\n  count: results.length,\n  generated_copy: results\n};"
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000012",
      "name": "Aggregate Results",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2304,
        304
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000013",
      "name": "Respond to Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        2400,
        304
      ]
    },
    {
      "parameters": {
        "content": "## [GENERATE] Platform Copy\n\n**Purpose:** Generate platform-specific ad/organic copy from video scripts\n\n**Input (webhook POST):**\n```json\n{\n  \"client_id\": \"uuid\",\n  \"platforms\": [\"meta\", \"tiktok\", \"youtube\"],\n  \"content_type\": \"ad\" | \"organic\",\n  \"script\": \"The video script text...\",\n  \"theme\": \"Tax Refund Season\",\n  \"vehicles\": [{\"year\": 2020, \"make\": \"Toyota\", \"model\": \"Camry\"}],\n  \"video_request_id\": \"uuid\" (optional),\n  \"plan_asset_id\": \"uuid\" (optional)\n}\n```\n\n**Output:**\n- Meta: primary_text, headline, description\n- TikTok: caption, hashtags\n- YouTube: title, description, tags\n\n**Data Sources:**\n1. `industry_copy_prompts` - Industry defaults\n2. `client_copy_prompts` - Client overrides\n3. `client_prompts` - Client identity/rules",
        "height": 540,
        "width": 380
      },
      "id": "a1b2c3d4-0001-0000-0000-000000000099",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -96,
        112
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2
          },
          "combinator": "and",
          "conditions": [
            {
              "leftValue": "={{ $('Webhook Trigger').first().json.body.store_copy ?? true }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "if-store-copy",
      "name": "If: Store Copy",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1904,
        304
      ]
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Pass through without storing - just add null stored_id\nreturn {\n  ...$json,\n  stored_id: null\n};"
      },
      "id": "skip-store",
      "name": "Skip Storage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2112,
        464
      ]
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Fetch Client",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Client": {
      "main": [
        [
          {
            "node": "Fetch Client Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Client Prompts": {
      "main": [
        [
          {
            "node": "Fetch Client Copy Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Client Copy Prompts": {
      "main": [
        [
          {
            "node": "Split by Platform",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split by Platform": {
      "main": [
        [
          {
            "node": "Fetch Industry Copy Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fetch Industry Copy Prompt": {
      "main": [
        [
          {
            "node": "Assemble Copy Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Assemble Copy Context": {
      "main": [
        [
          {
            "node": "Build AI Prompts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build AI Prompts": {
      "main": [
        [
          {
            "node": "Generate Copy (Claude)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Copy (Claude)": {
      "main": [
        [
          {
            "node": "Validate Char Counts",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Validate Char Counts": {
      "main": [
        [
          {
            "node": "If: Store Copy",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store Generated Copy": {
      "main": [
        [
          {
            "node": "Aggregate Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Results": {
      "main": [
        [
          {
            "node": "Respond to Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Store Copy": {
      "main": [
        [
          {
            "node": "Store Generated Copy",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Skip Storage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Skip Storage": {
      "main": [
        [
          {
            "node": "Aggregate Results",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "3923da63-5db7-4ba2-8190-d50d5385afc2",
  "activeVersionId": "3923da63-5db7-4ba2-8190-d50d5385afc2",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2026-01-29T15:03:42.069Z",
      "createdAt": "2026-01-29T15:03:42.069Z",
      "role": "workflow:owner",
      "workflowId": "3ds9Y97qpRjTI63Y",
      "projectId": "jfzY6AcGvieAQa3s"
    }
  ],
  "activeVersion": {
    "updatedAt": "2026-02-09T03:17:32.024Z",
    "createdAt": "2026-02-09T03:17:32.024Z",
    "versionId": "3923da63-5db7-4ba2-8190-d50d5385afc2",
    "workflowId": "3ds9Y97qpRjTI63Y",
    "nodes": [
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "generate-platform-copy",
          "responseMode": "responseNode",
          "options": {
            "allowedOrigins": "*"
          }
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000001",
        "name": "Webhook Trigger",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2,
        "position": [
          208,
          304
        ],
        "webhookId": "generate-platform-copy"
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT id, industry_id FROM clients WHERE id = '{{ $json.body.client_id }}'::uuid",
          "options": {}
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000002",
        "name": "Fetch Client",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          400,
          304
        ],
        "credentials": {
          "postgres": {
            "id": "ZUwzqy3kvUJpXrDM",
            "name": "Postgres (Dev)"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT prompt_type, prompt_content FROM client_prompts WHERE client_id = '{{ $(\"Fetch Client\").first().json.id }}'::uuid",
          "options": {}
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000003",
        "name": "Fetch Client Prompts",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          608,
          208
        ],
        "credentials": {
          "postgres": {
            "id": "ZUwzqy3kvUJpXrDM",
            "name": "Postgres (Dev)"
          }
        }
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT prompt_type, platform, content_type, prompt_content FROM client_copy_prompts WHERE client_id = '{{ $(\"Fetch Client\").first().json.id }}'::uuid",
          "options": {}
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000004",
        "name": "Fetch Client Copy Prompts",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          608,
          400
        ],
        "credentials": {
          "postgres": {
            "id": "ZUwzqy3kvUJpXrDM",
            "name": "Postgres (Dev)"
          }
        },
        "alwaysOutputData": true
      },
      {
        "parameters": {
          "jsCode": "// Extract platforms from input\nconst input = $(\"Webhook Trigger\").item.json.body;\nconst platforms = input.platforms || [\"meta\"];\n\n// Return one item per platform for the loop\nreturn platforms.map(platform => ({\n  json: {\n    platform,\n    ...input\n  }\n}));"
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000005",
        "name": "Split by Platform",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          800,
          304
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "SELECT platform, content_type, prompt_content FROM industry_copy_prompts WHERE industry_id = '{{ $(\"Fetch Client\").first().json.industry_id }}'::uuid AND platform = '{{ $json.platform }}' AND content_type = '{{ $json.content_type }}'",
          "options": {}
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000006",
        "name": "Fetch Industry Copy Prompt",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          1008,
          304
        ],
        "credentials": {
          "postgres": {
            "id": "ZUwzqy3kvUJpXrDM",
            "name": "Postgres (Dev)"
          }
        }
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "// ═══════════════════════════════════════════════════════════════\n// PLATFORM COPY GENERATOR - PROMPT ASSEMBLER\n// ═══════════════════════════════════════════════════════════════\n\n// $json contains the output from Fetch Industry Copy Prompt for THIS item\nconst input = $json;\nconst { platform, content_type, template_type, format, theme, vehicles, script, prompt_content } = input;\n\n// Get data from other nodes (these are the same for all platforms)\nconst clientPromptsAll = $('Fetch Client Prompts').all();\nconst clientCopyPromptsAll = $('Fetch Client Copy Prompts').all();\n\n// Parse JSONB if needed\nconst parseJsonb = (val) => {\n  if (!val) return {};\n  if (typeof val === 'string') {\n    try { return JSON.parse(val); } catch { return {}; }\n  }\n  return val;\n};\n\n// The industry prompt comes directly from the current item ($json)\nconst industryPrompt = parseJsonb(prompt_content);\n\nconst clientBase = parseJsonb(clientPromptsAll.find(r => r.json.prompt_type === 'base')?.json?.prompt_content);\nconst clientRules = parseJsonb(clientPromptsAll.find(r => r.json.prompt_type === 'rules')?.json?.prompt_content) || [];\nconst clientCopyBase = parseJsonb(clientCopyPromptsAll.find(r => r.json.prompt_type === 'base')?.json?.prompt_content);\nconst clientCopyOverride = parseJsonb(clientCopyPromptsAll.find(r => \n  r.json.prompt_type === 'override' && \n  r.json.platform === platform && \n  r.json.content_type === content_type\n)?.json?.prompt_content);\n\n// Deep merge helper\nfunction deepMerge(target, ...sources) {\n  for (const source of sources) {\n    if (!source) continue;\n    for (const key of Object.keys(source)) {\n      if (source[key] && typeof source[key] === 'object' && !Array.isArray(source[key])) {\n        target[key] = deepMerge(target[key] || {}, source[key]);\n      } else {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n}\n\n// Merge all layers: industry < client copy base < client copy override\nconst mergedConfig = deepMerge(\n  {},\n  industryPrompt,\n  clientCopyBase,\n  clientCopyOverride\n);\n\n// Build final prompt context - return single item (mode is runOnceForEachItem)\nreturn {\n  platform,\n  content_type,\n  format: format || 'video',\n  template_type,\n  theme,\n  vehicles,\n  script,\n  \n  // Merged config for this platform + content_type\n  platform_config: mergedConfig,\n  \n  // Client identity\n  client: {\n    name: clientBase?.identity?.business_name,\n    location: clientBase?.identity?.location,\n    contact_name: clientCopyBase?.contact?.contact_name,\n    phone: clientCopyBase?.contact?.phone,\n    phone_display: clientCopyBase?.contact?.phone_display,\n    location_display: clientCopyBase?.location?.with_emoji\n  },\n  \n  // Client rules\n  rules: Array.isArray(clientRules) ? clientRules : [],\n  \n  // Hashtags (merged)\n  hashtags: {\n    always: clientCopyBase?.hashtags?.always_include || [],\n    local: clientCopyBase?.hashtags?.local || [],\n    industry: mergedConfig?.hashtags?.examples || [],\n    avoid: mergedConfig?.hashtags?.avoid || []\n  }\n};"
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000007",
        "name": "Assemble Copy Context",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1200,
          304
        ]
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "// Build the system prompt based on platform\nconst ctx = $json;\nconst platform = ctx.platform;\nconst contentType = ctx.content_type;\nconst config = ctx.platform_config || {};\n\n// Webhook input\n// This gets the first item from that node regardless of pairing\nconst input = $('Split by Platform').first().json;\n\n\nlet systemPrompt = `You are an expert social media copywriter for local businesses.\n\nPLATFORM: ${platform.toUpperCase()}\nCONTENT TYPE: ${contentType.toUpperCase()}\n\n`;\n\n// Add critical rules for organic\nif (contentType === 'organic' && config.critical_rules) {\n  systemPrompt += `CRITICAL RULES (violating these = content suppression):\\n`;\n  config.critical_rules.forEach(rule => {\n    systemPrompt += `- ${rule}\\n`;\n  });\n  systemPrompt += `\\n`;\n}\n\n// Add tone\nif (config.tone) {\n  systemPrompt += `TONE: ${config.tone}\\n\\n`;\n}\n\n// Platform-specific structure\nif (platform === 'meta') {\n  systemPrompt += `OUTPUT FORMAT (JSON):\n{\n  \"primary_text\": \"<your copy here with line breaks as \\\\n>\",\n  \"headline\": \"<40 chars max, punchy>\",\n  \"description\": \"<30 chars max>\"\n}\\n\\n`;\n  \n  if (config.primary_text) {\n    systemPrompt += `PRIMARY TEXT RULES:\\n`;\n    systemPrompt += `- Structure: ${(config.primary_text.structure || []).join(' → ')}\\n`;\n    systemPrompt += `- Max ${config.primary_text.max_chars_before_fold || 125} chars before \"See more\" fold\\n`;\n    if (config.primary_text.emojis) systemPrompt += `- Emojis: ${config.primary_text.emojis}\\n`;\n    systemPrompt += `\\n`;\n  }\n  if (config.headline) {\n    systemPrompt += `HEADLINE RULES:\\n`;\n    systemPrompt += `- Max ${config.headline.max_chars || 40} chars\\n`;\n    systemPrompt += `- Style: ${config.headline.style || 'Punchy'}\\n`;\n    if (config.headline.avoid) systemPrompt += `- Avoid: ${config.headline.avoid.join(', ')}\\n`;\n    systemPrompt += `\\n`;\n  }\n} else if (platform === 'tiktok') {\n  systemPrompt += `OUTPUT FORMAT (JSON):\n{\n  \"caption\": \"<your caption here>\",\n  \"hashtags\": [\"#tag1\", \"#tag2\", ...]\n}\\n\\n`;\n  \n  if (config.caption) {\n    systemPrompt += `CAPTION RULES:\\n`;\n    systemPrompt += `- Max ${config.caption.max_chars || 150} characters\\n`;\n    systemPrompt += `- Style: ${config.caption.style || 'casual, trendy'}\\n`;\n    systemPrompt += `\\n`;\n  }\n  if (config.hooks) {\n    systemPrompt += `GOOD HOOKS: ${(config.hooks.good || []).join(', ')}\\n`;\n    systemPrompt += `AVOID: ${(config.hooks.avoid || []).join(', ')}\\n\\n`;\n  }\n} else if (platform === 'youtube') {\n  systemPrompt += `OUTPUT FORMAT (JSON):\n{\n  \"title\": \"<60 chars max>\",\n  \"description\": \"<full description>\",\n  \"tags\": [\"tag1\", \"tag2\", ...]\n}\\n\\n`;\n  if (config.title) {\n    systemPrompt += `TITLE RULES:\\n`;\n    systemPrompt += `- Max ${config.title.max_chars || 60} chars\\n`;\n    if (config.title.style) systemPrompt += `- Style: ${config.title.style}\\n`;\n    systemPrompt += `\\n`;\n  }\n}\n\n// Add terminology guidance\nif (config.terminology) {\n  if (config.terminology.prefer?.length) {\n    systemPrompt += `PREFERRED WORDS: ${config.terminology.prefer.join(', ')}\\n`;\n  }\n  if (config.terminology.avoid?.length) {\n    systemPrompt += `AVOID WORDS: ${config.terminology.avoid.join(', ')}\\n`;\n  }\n  systemPrompt += `\\n`;\n}\n\n// Build user prompt\nlet userPrompt = '';\n\nif (input.script) {\n  userPrompt += `VIDEO SCRIPT:\\n\"\"\"\\n${input.script}\\n\"\"\"\\n\\nWrite copy that complements this script. Reference the specific vehicles and benefits mentioned.\\n\\n`;\n}\n\nif (input.theme) {\n  userPrompt += `THEME: ${input.theme}\\n\\n`;\n}\n\nif (ctx.vehicles && ctx.vehicles.length) {\n  userPrompt += `FEATURED VEHICLES:\\n`;\n  ctx.vehicles.forEach(v => {\n    userPrompt += `- ${v.year || ''} ${v.make || ''} ${v.model || ''}${v.price ? ' - $' + v.price : ''}\\n`;\n  });\n  userPrompt += `\\n`;\n}\n\n// Add client info for contact/location\nif (ctx.client?.phone_display) {\n  userPrompt += `CONTACT: ${ctx.client.phone_display}\\n`;\n}\nif (ctx.client?.location_display) {\n  userPrompt += `LOCATION: ${ctx.client.location_display}\\n`;\n}\n\n// Add hashtag guidance\nif (platform !== 'youtube') {\n  if (ctx.hashtags?.always?.length) {\n    userPrompt += `\\nHASHTAGS TO INCLUDE: ${ctx.hashtags.always.join(', ')}\\n`;\n  }\n  if (ctx.hashtags?.local?.length) {\n    userPrompt += `LOCAL HASHTAGS: ${ctx.hashtags.local.join(', ')}\\n`;\n  }\n  if (ctx.hashtags?.avoid?.length) {\n    userPrompt += `AVOID THESE HASHTAGS: ${ctx.hashtags.avoid.join(', ')}\\n`;\n  }\n}\n\nuserPrompt += `\\nGenerate the ${platform} ${contentType} copy now. Return ONLY valid JSON, no markdown.`;\n\nreturn {\n  ...ctx,\n  system_prompt: systemPrompt,\n  user_prompt: userPrompt\n};"
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000008",
        "name": "Build AI Prompts",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1408,
          304
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.anthropic.com/v1/messages",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "anthropicApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "anthropic-version",
                "value": "2023-06-01"
              },
              {
                "name": "content-type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "model",
                "value": "claude-sonnet-4-20250514"
              },
              {
                "name": "max_tokens",
                "value": "={{1024}}"
              },
              {
                "name": "system",
                "value": "={{$json.system_prompt || \"\"}}"
              },
              {
                "name": "messages",
                "value": "={{ [{\"role\": \"user\", \"content\": $json.user_prompt}] }}"
              }
            ]
          },
          "options": {
            "timeout": 60000
          }
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000009",
        "name": "Generate Copy (Claude)",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          1600,
          304
        ],
        "credentials": {
          "anthropicApi": {
            "id": "Cias5aAJewPKMMCa",
            "name": "Anthropic account"
          }
        }
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "// Get context from current item (mode is runOnceForEachItem)\n// Previous nodes pass data through, so we look at Build AI Prompts for context\nconst prevData = $('Build AI Prompts').item.json;\nconst claudeResponse = $json;\n\nlet generatedCopy;\ntry {\n  let content = claudeResponse.content?.[0]?.text || '';\n  content = content.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n  generatedCopy = JSON.parse(content);\n} catch (e) {\n  return {\n    error: 'Failed to parse: ' + e.message,\n    platform: prevData.platform,\n    content_type: prevData.content_type\n  };\n}\n\n// Normalize TikTok hashtags to array if returned as string\nif (prevData.platform === 'tiktok' && generatedCopy.hashtags) {\n  if (typeof generatedCopy.hashtags === 'string') {\n    generatedCopy.hashtags = generatedCopy.hashtags\n      .split(/[,\\s]+/)\n      .map(h => h.trim())\n      .filter(h => h.startsWith('#'));\n  }\n}\n\nconst warnings = [];\nconst charCounts = {};\n\nif (prevData.platform === 'meta') {\n  if (generatedCopy.primary_text) {\n    charCounts.primary_text = generatedCopy.primary_text.length;\n    const firstLine = generatedCopy.primary_text.split('\\n')[0];\n    charCounts.primary_before_fold = firstLine.length;\n    if (firstLine.length > 125) warnings.push('Primary text first line: ' + firstLine.length + ' chars (125 max)');\n  }\n  if (generatedCopy.headline) {\n    charCounts.headline = generatedCopy.headline.length;\n    if (generatedCopy.headline.length > 40) warnings.push('Headline: ' + generatedCopy.headline.length + ' chars (40 max)');\n  }\n  if (generatedCopy.description) {\n    charCounts.description = generatedCopy.description.length;\n    if (generatedCopy.description.length > 30) warnings.push('Description: ' + generatedCopy.description.length + ' chars (30 max)');\n  }\n} else if (prevData.platform === 'tiktok') {\n  if (generatedCopy.caption) {\n    charCounts.caption = generatedCopy.caption.length;\n    if (generatedCopy.caption.length > 150) warnings.push('Caption: ' + generatedCopy.caption.length + ' chars (150 max)');\n  }\n}\n\nreturn {\n  platform: prevData.platform,\n  content_type: prevData.content_type,\n  format: prevData.format || 'video',\n  copy: generatedCopy,\n  char_counts: charCounts,\n  warnings,\n  client_id: prevData.client_id,\n  video_request_id: prevData.video_request_id,\n  plan_asset_id: prevData.plan_asset_id\n};"
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000010",
        "name": "Validate Char Counts",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          1808,
          304
        ]
      },
      {
        "parameters": {
          "operation": "executeQuery",
          "query": "INSERT INTO generated_copy (video_request_id, plan_asset_id, platform, content_type, format, copy_content) VALUES ({{ $json.video_request_id ? \"'\" + $json.video_request_id + \"'::uuid\" : \"NULL\" }}, {{ $json.plan_asset_id ? \"'\" + $json.plan_asset_id + \"'::uuid\" : \"NULL\" }}, '{{ $json.platform }}', '{{ $json.content_type }}', '{{ $json.format }}', '{{ JSON.stringify({ copy: $json.copy, char_counts: $json.char_counts, warnings: $json.warnings }).replace(/'/g, \"''\") }}'::jsonb) RETURNING id, platform, content_type",
          "options": {}
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000011",
        "name": "Store Generated Copy",
        "type": "n8n-nodes-base.postgres",
        "typeVersion": 2.5,
        "position": [
          2112,
          208
        ],
        "credentials": {
          "postgres": {
            "id": "ZUwzqy3kvUJpXrDM",
            "name": "Postgres (Dev)"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "// Aggregate all generated copy for response\nconst allCopy = $('Validate Char Counts').all();\n\n// Check if we have stored results or skipped storage\nlet storedResults = [];\ntry {\n  storedResults = $('Store Generated Copy').all();\n} catch (e) {\n  // Storage was skipped\n}\n\nlet skipResults = [];\ntry {\n  skipResults = $('Skip Storage').all();\n} catch (e) {\n  // Storage was not skipped\n}\n\nconst results = allCopy.map((item, i) => ({\n  platform: item.json.platform,\n  content_type: item.json.content_type,\n  copy: item.json.copy,\n  char_counts: item.json.char_counts,\n  warnings: item.json.warnings,\n  stored_id: storedResults[i]?.json?.id || skipResults[i]?.json?.stored_id || null\n}));\n\nreturn {\n  success: true,\n  count: results.length,\n  generated_copy: results\n};"
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000012",
        "name": "Aggregate Results",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2304,
          304
        ]
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000013",
        "name": "Respond to Webhook",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          2400,
          304
        ]
      },
      {
        "parameters": {
          "content": "## [GENERATE] Platform Copy\n\n**Purpose:** Generate platform-specific ad/organic copy from video scripts\n\n**Input (webhook POST):**\n```json\n{\n  \"client_id\": \"uuid\",\n  \"platforms\": [\"meta\", \"tiktok\", \"youtube\"],\n  \"content_type\": \"ad\" | \"organic\",\n  \"script\": \"The video script text...\",\n  \"theme\": \"Tax Refund Season\",\n  \"vehicles\": [{\"year\": 2020, \"make\": \"Toyota\", \"model\": \"Camry\"}],\n  \"video_request_id\": \"uuid\" (optional),\n  \"plan_asset_id\": \"uuid\" (optional)\n}\n```\n\n**Output:**\n- Meta: primary_text, headline, description\n- TikTok: caption, hashtags\n- YouTube: title, description, tags\n\n**Data Sources:**\n1. `industry_copy_prompts` - Industry defaults\n2. `client_copy_prompts` - Client overrides\n3. `client_prompts` - Client identity/rules",
          "height": 540,
          "width": 380
        },
        "id": "a1b2c3d4-0001-0000-0000-000000000099",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -96,
          112
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2
            },
            "combinator": "and",
            "conditions": [
              {
                "leftValue": "={{ $('Webhook Trigger').first().json.body.store_copy ?? true }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ]
          },
          "options": {}
        },
        "id": "if-store-copy",
        "name": "If: Store Copy",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          1904,
          304
        ]
      },
      {
        "parameters": {
          "mode": "runOnceForEachItem",
          "jsCode": "// Pass through without storing - just add null stored_id\nreturn {\n  ...$json,\n  stored_id: null\n};"
        },
        "id": "skip-store",
        "name": "Skip Storage",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          2112,
          464
        ]
      }
    ],
    "connections": {
      "Webhook Trigger": {
        "main": [
          [
            {
              "node": "Fetch Client",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Client": {
        "main": [
          [
            {
              "node": "Fetch Client Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Client Prompts": {
        "main": [
          [
            {
              "node": "Fetch Client Copy Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Client Copy Prompts": {
        "main": [
          [
            {
              "node": "Split by Platform",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split by Platform": {
        "main": [
          [
            {
              "node": "Fetch Industry Copy Prompt",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fetch Industry Copy Prompt": {
        "main": [
          [
            {
              "node": "Assemble Copy Context",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Assemble Copy Context": {
        "main": [
          [
            {
              "node": "Build AI Prompts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Build AI Prompts": {
        "main": [
          [
            {
              "node": "Generate Copy (Claude)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Generate Copy (Claude)": {
        "main": [
          [
            {
              "node": "Validate Char Counts",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Validate Char Counts": {
        "main": [
          [
            {
              "node": "If: Store Copy",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Store Generated Copy": {
        "main": [
          [
            {
              "node": "Aggregate Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate Results": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If: Store Copy": {
        "main": [
          [
            {
              "node": "Store Generated Copy",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Skip Storage",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Skip Storage": {
        "main": [
          [
            {
              "node": "Aggregate Results",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Kelly Knight",
    "name": null,
    "description": null,
    "autosaved": false
  },
  "tags": []
}