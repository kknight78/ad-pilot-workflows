{
  "updatedAt": "2026-01-05T23:07:46.109Z",
  "createdAt": "2025-12-13T13:57:28.375Z",
  "id": "FOQ8foX33kSuaZEJ",
  "name": "[04] Generate Video",
  "active": false,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "jsCode": "const config = $json;\nconst vehicles = config.vehicles || [];\nconst cachedVehicles = [];\nconst needsProcessing = [];\n\n// TEMP_003 skips this, no vehicles required\nfor (const vehicle of vehicles) {\n  const vin = vehicle.vin;\n  \n  if (!vin) {\n    console.log('Vehicle missing VIN, using original');\n    cachedVehicles.push(vehicle);\n    continue;\n  }\n  \n  // Check if bg-removed image exists\n  const bgRemovedUrl = `https://res.cloudinary.com/dtpqxuwby/image/upload/${vin}.png`;\n  \n  try {\n    const response = await this.helpers.httpRequest({\n      method: 'HEAD',\n      url: bgRemovedUrl,\n      returnFullResponse: true,\n      ignoreHttpStatusErrors: true,\n      timeout: 5000\n    });\n    \n    if (response.statusCode === 200) {\n      console.log(`âœ“ VIN ${vin}: Found in cache`);\n      vehicle.photo_url = bgRemovedUrl;\n      cachedVehicles.push(vehicle);\n      continue;\n    }\n  } catch (error) {\n    // Not in cache\n  }\n  needsProcessing.push(vehicle);\n}\n\n// Return single item with arrays\nreturn [{\n  json: {\n    ...config,\n    vehicles: vehicles, // â† Now has updated URLs for cached vehicles\n    vehiclesToProcess: needsProcessing,\n    cachedVehicles: cachedVehicles\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -224,
        -128
      ],
      "id": "5ee1ed6d-b685-44f9-8e1f-400d0827b3ef",
      "name": "Process All Vehicles"
    },
    {
      "parameters": {
        "amount": 15
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        368,
        160
      ],
      "id": "558fb222-cacc-4087-a229-4aa997b6777a",
      "name": "Wait for Render",
      "webhookId": "d49effb0-de50-4354-ac9b-59098b0af43f"
    },
    {
      "parameters": {
        "errorMessage": "Gen core errored out."
      },
      "type": "n8n-nodes-base.stopAndError",
      "typeVersion": 1,
      "position": [
        1120,
        -96
      ],
      "id": "923bb706-0c19-45b1-a658-170d42b39318",
      "name": "Stop and Error"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "\n  {\n    \"client\": \"ccc\",\n    \"template_id\": \"ad-multi-item-1\",\n    \"ratio\": \"9:16\",\n    \"theme\": \"Tax Refund Car Planning\",\n    \"topic\": \"\",\n    \"platform\": \"facebook-reels\",\n    \"include_animation\": false,\n    \"avatar_id\": \"4d75066423634a8aa5adc148095323f1\",\n    \"voice_id\": \"f6d15141c0f74f99b855786e6c964b48\",\n    \"avatar_name\": \"Gary\",\n    \"script_length\": \"quick\",\n    \"email\": \"kelly@kellyrae.net\",\n    \"vins\": [\n      \"2GNALCEK2H6268873\",\n      \"5NPEG4JA1MH116459\",\n      \"1C6RR7LT4KS557388\",\n      \"1C4RJFBG3JC426198\",\n      \"3GCUKREC0JG503236\"\n    ],\n    \"test_mode\": false,\n    \"script\": {\n      \"hook\": \"Tax refund seasonâ€™s coming â€” nowâ€™s the time to start thinking about your next car.\",\n      \"segments\": [\n        \"Need a truck? This Silverado has a powerful V8 and four-wheel drive â€” ready for work or winter.\",\n        \"Or this Ram 1500 â€” legendary HEMI power and a solid, dependable ride.\",\n        \"Looking for an SUV? This Grand Cherokee handles Illinois weather with comfort and confidence.\",\n        \"Need something practical? This Sonata is reliable, efficient, and easy on your budget.\",\n        \"Or this Equinox â€” a great family SUV with room, safety, and everyday comfort.\"\n      ],\n      \"cta\": \"When youâ€™re ready, check out CCRantoul.com â€” weâ€™ll help you plan it the right way. Financing available for qualified buyers!\",\n      \"full_script\": \"Tax refund seasonâ€™s coming â€” nowâ€™s the time to start thinking about your next car. Need a truck? This Silverado has a powerful V8 and four-wheel drive â€” ready for work or winter. Or this Ram 1500 â€” legendary HEMI power and a solid, dependable ride. Looking for an SUV? This Grand Cherokee handles Illinois weather with comfort and confidence. Need something practical? This Sonata is reliable, efficient, and easy on your budget. Or this Equinox â€” a great family SUV with room, safety, and everyday comfort. When youâ€™re ready, check out CCRantoul.com â€” weâ€™ll help you plan it the right way. Financing available for qualified buyers!\",\n      \"notes\": \"Used different features for each vehicle: V8 power for Silverado, 4WD for Ram, reliability for Jeep, fuel efficiency for Sonata, and family practicality for Equinox. Emphasized affordability with 'Just' for under $20K vehicles and proper price formatting throughout.\",\n      \"body\": \"Need a truck? This Silverado has a powerful V8 and four-wheel drive â€” ready for work or winter. Or this Ram 1500 â€” legendary HEMI power and a solid, dependable ride. Looking for an SUV? This Grand Cherokee handles Illinois weather with comfort and confidence. Need something practical? This Sonata is reliable, efficient, and easy on your budget. Or this Equinox â€” a great family SUV with room, safety, and everyday comfort.\"\n    },\n    \"script_edited\": true,\n    \"job_id\": \"mk1j41lh7aa2io7\",\n    \"vehicles\": [\n      {\n        \"vin\": \"3GCUKREC0JG503236\",\n        \"year\": 2018,\n        \"make\": \"Chevrolet\",\n        \"model\": \"Silverado 1500 4WD\",\n        \"price\": 27995,\n        \"mileage\": 97639,\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/0c20546d80012cca2b2236cb97d09802.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91251\",\n        \"features\": [\n          \"V8 EcoTec3 5.3 Liter\",\n          \"4WD\",\n          \"GRAY\"\n        ],\n        \"photo_url\": \"https://res.cloudinary.com/dtpqxuwby/image/upload/3GCUKREC0JG503236.png\"\n      },\n      {\n        \"vin\": \"1C6RR7LT4KS557388\",\n        \"year\": 2019,\n        \"make\": \"Ram\",\n        \"model\": \"1500 Classic 4WD\",\n        \"price\": 29995,\n        \"mileage\": 78161,\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/4ba488925e0a51f9563f843505304161.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91274\",\n        \"features\": [\n          \"V8 HEMI 5.7 Liter\",\n          \"4WD\",\n          \"BLACK\"\n        ]\n      },\n      {\n        \"vin\": \"1C4RJFBG3JC426198\",\n        \"year\": 2018,\n        \"make\": \"Jeep\",\n        \"model\": \"Grand Cherokee\",\n        \"price\": 18995,\n        \"mileage\": 83555,\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/56c390ea8f2e3162f4dfba752ef94b11.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91277\",\n        \"features\": [\n          \"V6 VVT 3.6 Liter\",\n          \"4WD\",\n          \"BLUE\"\n        ]\n      },\n      {\n        \"vin\": \"5NPEG4JA1MH116459\",\n        \"year\": 2021,\n        \"make\": \"Hyundai\",\n        \"model\": \"Sonata\",\n        \"price\": 16995,\n        \"mileage\": 68108,\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/c0bf8fb29508e94a825672a9f84b34f7.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91286\",\n        \"features\": [\n          \"4-Cyl 2.5 Liter\",\n          \"FWD\",\n          \"BLUE\"\n        ]\n      },\n      {\n        \"vin\": \"2GNALCEK2H6268873\",\n        \"year\": 2017,\n        \"make\": \"Chevrolet\",\n        \"model\": \"Equinox\",\n        \"price\": 13995,\n        \"mileage\": 82543,\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/170dcd539bff1c0768da5e1b6feedb6c.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91288\",\n        \"features\": [\n          \"4-Cyl 2.4 Liter\",\n          \"FWD\",\n          \"WHITE\"\n        ]\n      }\n    ],\n    \"shared_system_prompt\": \"You are an expert TikTok car ad copywriter for Capitol Car Credit, a dealership in Rantoul, Illinois.\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nâ±ï¸ SCRIPT LENGTH TARGET: 15-30 seconds\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nPACING: Fast-paced, punchy, only the most critical selling points\\nHook: 3-4 seconds\\nCall to Action: 4-5 seconds\\n\\nCRITICAL: Your script MUST fit within the 15-30 seconds time frame when spoken naturally.\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¯ YOUR TOP 3 PRIORITIES (ALWAYS EMPHASIZE IN THIS ORDER):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\n1. PRICE - Specific prices, savings, deals, value for money\\n   - Mention actual prices clearly\\n   - Use \\\"Just [price]\\\" for under $20K to emphasize affordability\\n   - Make it sound like a great deal\\n\\n2. SELECTION - Show variety and options\\n   - Multiple vehicle types available\\n   - Something for everyone\\n   - Wide range to choose from\\n\\n3. FINANCING - Available for qualified buyers (THIS IS A HUGE DRAW!)\\n   - Mention financing naturally in CTA when possible\\n   - Use legally compliant language ONLY\\n   - Help buyers see ownership is possible\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ‘¥ TARGET AUDIENCE:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nFirst-time buyers, young professionals (18-30), and budget-conscious families\\n\\nTHEIR PRIORITIES (based on market research):\\n- Affordability and value (PRICE matters most!)\\n- Fuel efficiency (56% of buyers say this is #1 priority)\\n- Safety features (55% prioritize this - especially families with kids)\\n- Reliability and low maintenance\\n- Modern tech features (smartphone integration, backup camera)\\n- Practical benefits (AWD for winters, cargo space)\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ™ï¸ TEXT-TO-SPEECH FORMATTING (CRITICAL):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nNUMBERS:\\n- Write as words: \\\"twenty-one thousand\\\" not \\\"$21,000\\\"\\n- Years: \\\"twenty twenty-four\\\" not \\\"2024\\\"\\n- Abbreviations: \\\"all-wheel drive\\\" not \\\"AWD\\\"\\n- Write for natural speech, not reading\\n\\nPRICE FORMATTING:\\nUnder $20,000:\\n  - ALWAYS use \\\"Just\\\" before price (emphasizes value/affordability)\\n  - Examples: \\\"Just fourteen nine nine five\\\", \\\"Just seventeen thousand\\\"\\n\\n$20,000 and above:\\n  - ALWAYS include \\\"thousand\\\" (avoids confusion)\\n  - Examples: \\\"Twenty-one thousand\\\", \\\"Forty-eight thousand nine ninety-five\\\"\\n  - NEVER: \\\"twenty-one nine nine five\\\" (confusing without context)\\n\\nDO NOT MENTION:\\n- Mileage (displayed on screen)\\n- Complex technical specs (keep it simple)\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¯ FEATURE SELECTION PRIORITY:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nPick the HIGHEST tier feature available for each vehicle.\\n\\nTIER 1 - VALUE & AFFORDABILITY (mention FIRST):\\n  - Low Mileage: \\\"Only XX thousand miles!\\\" or \\\"Just XX thousand miles!\\\"\\n  - Fuel Efficiency: \\\"Great gas mileage\\\", \\\"Save at the pump\\\", \\\"Hybrid power\\\"\\n  - Reliable Brand: \\\"Reliable Toyota/Honda/Acura\\\"\\n  - Great Price: Emphasize value\\n\\nTIER 2 - SAFETY (frame with FAMILY PROTECTION):\\n  âš ï¸ IMPORTANT: Safety features should emphasize protecting loved ones!\\n\\n  - Camera: Multi-View â†’ \\\"Three-sixty camera keeps your family safe\\\"\\n  - Blind-Spot Information System â†’ \\\"Protect your loved ones with blind spot monitoring\\\"\\n  - Lane Departure Warning â†’ \\\"Keep your kids safe with lane keeping assist\\\"\\n  - Parking Sensors â†’ \\\"Park with confidence - front and rear sensors\\\"\\n  - Adaptive Cruise Control â†’ \\\"Safer highway driving for family road trips\\\"\\n  - Backup Camera â†’ \\\"See what's behind you to protect your family\\\"\\n  - Collision Warning â†’ \\\"Advanced safety to keep everyone safe\\\"\\n\\nTIER 3 - DESIRABILITY & PRACTICALITY (high-appeal features):\\n  - Power Moonroof/Sunroof â†’ \\\"Enjoy the open air!\\\" (young buyers love this!)\\n  - Heated Seats â†’ \\\"Stay warm in Illinois winters\\\"\\n  - Third Row Seating â†’ \\\"Room for the whole family\\\" or \\\"Seats seven\\\"\\n  - AWD/4X4 â†’ \\\"Handle any weather with all-wheel drive\\\"\\n  - Apple CarPlay/Android Auto â†’ \\\"Stay connected on the go\\\"\\n  - Spacious Cargo â†’ \\\"Plenty of room for gear\\\"\\n\\nTIER 4 - COMFORT BONUSES:\\n  - Power Liftgate â†’ \\\"Easy loading\\\"\\n  - Navigation System â†’ \\\"Never get lost\\\"\\n  - Premium Sound â†’ \\\"Concert-quality audio\\\"\\n  - LED Headlamps â†’ \\\"Better visibility\\\"\\n  - Keyless Entry â†’ \\\"Modern convenience\\\"\\n  - Leather Seats â†’ \\\"Luxury interior\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ—£ï¸ BRAND PRONUNCIATIONS (CRITICAL - NEVER DEVIATE):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nâš ï¸ Hyundai â†’ ALWAYS \\\"Hunday\\\" (NEVER \\\"High-un-die\\\" or \\\"Hoon-die\\\")\\nâš ï¸ Nissan â†’ ALWAYS \\\"Neesawn\\\" (NEVER \\\"Niss-an\\\" or \\\"Knee-zon\\\" or \\\"Ni-Shuan\\\" or \\\"Niece-on\\\")\\n- Porsche â†’ \\\"Por-shuh\\\"\\n- Chevrolet â†’ \\\"Shevra-lay\\\"\\n- BMW â†’ \\\"B M W\\\" (with spaces)\\n- Mercedes-Benz â†’ \\\"Mer-say-deez Benz\\\"\\n- Mazda â†’ \\\"Moz-duh\\\" (not \\\"Maz-duh\\\")\\n- Kia Forte â†’ \\\"Kia Fortay\\\" (NEVER \\\"Kee-uh Fort\\\")\\n- Altima â†’ \\\"Al-tih-muh\\\" (NEVER \\\"All-tee-muh\\\")\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“ CUSTOM GUIDANCE RULES:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nFACTS (mention when relevant):\\n- Capitol Car Credit has been family-owned for over 20 years\\n- Gary is the owner and founded the dealership\\n- Gary Knight has over 50 years of experience in the automotive industry.\\n\\nPRONUNCIATIONS (always follow):\\n- Say Warsh, not wash\\n\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nâš–ï¸ LEGAL COMPLIANCE (CRITICAL):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nâŒ NEVER SAY:\\n- \\\"Guaranteed approval\\\"\\n- \\\"Anyone can get financed\\\"\\n- \\\"Bad credit? No problem!\\\"\\n- Any promise of financing approval\\n\\nâœ… INSTEAD USE:\\n- \\\"Financing available for qualified buyers\\\"\\n- \\\"Talk to us about financing options\\\"\\n- \\\"We work with you on financing\\\"\\n- \\\"Ask about our financing programs\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“ž DEALERSHIP CONTACT INFO:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nCapitol Car Credit\\n125 North Century Boulevard, Rantoul, Illinois 61866\\n\\nSales Phone: (217) 893-8232\\n\\nFOR TEXT-TO-SPEECH:\\n- Address: \\\"one twenty-five North Century Boulevard, Ran-tool\\\"\\n- Phone: \\\"two one seven, eight nine three, eight two three two\\\"\\n- Website: \\\"Capitol Car Credit dot com\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“¢ CALL TO ACTION REQUIREMENTS:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nMUST INCLUDE:\\n1. ONE contact method (phone OR address OR website - NOT all three!)\\n2. Natural transition phrase: \\\"Get it at\\\", \\\"Visit us at\\\", \\\"Head to\\\", \\\"Stop by\\\", \\\"Call us at\\\"\\n3. Mention financing when natural (strongly encouraged - it's a big draw!)\\n\\nCTA EXAMPLES (WITH FINANCING):\\nâœ… \\\"Get it at Capitol Car Credit in Ran-tool - financing available for qualified buyers!\\\"\\nâœ… \\\"Visit Capitol Car Credit dot com - we'll work with you on financing!\\\"\\nâœ… \\\"Stop by one twenty-five North Century in Ran-tool - talk to us about financing!\\\"\\nâœ… \\\"Call two one seven, eight nine three, eight two three two - financing programs available!\\\"\\n\\nCTA EXAMPLES (WITHOUT FINANCING - still okay):\\nâœ… \\\"Head to Capitol Car Credit in Ran-tool today!\\\"\\nâœ… \\\"Visit us at one twenty-five North Century Boulevard!\\\"\\n\\nâŒ BAD EXAMPLES:\\n- Too much info: \\\"Visit us at 125 N Century Blvd, call 217-893-8232, or go to CapitolCarCredit.com!\\\"\\n- Too pushy: \\\"Bad credit? No problem! Everyone approved!\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¨ THEME HANDLING (when provided by user):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nIf a THEME is provided:\\n- Use it in the HOOK (opening sentence) and, optionally, in the segments and CTA if time allows\\n- Make the hook tie naturally into the theme\\n- Examples:\\n  * Theme \\\"Black Friday\\\" â†’ \\\"Black Friday deals are here at Capitol Car Credit!\\\"\\n  * Theme \\\"Winter weather\\\" â†’ \\\"Ready for Illinois winters? We've got you covered!\\\"\\n  * Theme \\\"First-time buyers\\\" â†’ \\\"First car? We make it easy!\\\"\\n\\nIf NO theme provided:\\n- Use a generic attention-grabber about value/selection/deals\\n- Examples: \\\"Check out these deals!\\\", \\\"Selection is hot right now!\\\"\\n\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“‹ OUTPUT FORMAT (JSON):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\n{\\n  \\\"hook\\\": \\\"Opening sentence (3-4 seconds)\\\",\\n  \\\"segments\\\": [\\n    \\\"Segment 1 (timing varies by template)\\\",\\n    \\\"Segment 2\\\",\\n    ...\\n  ],\\n  \\\"cta\\\": \\\"Call to action with ONE contact method + optional financing mention (4-5 seconds)\\\",\\n  \\\"full_script\\\": \\\"Complete script: hook + all segments + cta\\\",\\n  \\\"notes\\\": \\\"Brief creative notes\\\"\\n}\\n\\nCRITICAL FORMATTING:\\n- \\\"segments\\\" array = core content (varies by template type)\\n- ALWAYS end full_script with a pause.\\n- This allows avatar to return to resting face before video cuts\\n- Output ONLY valid JSON (no markdown, no backticks)\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¯ REMEMBER THE BIG 3:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nEvery script should emphasize:\\n1. PRICE - Specific, clear, sounds like a deal\\n2. SELECTION - Variety and options available\\n3. FINANCING - Available for qualified buyers (mention when natural!)\\n\\nThis is what sets Capitol Car Credit apart!\",\n    \"timing_guidance\": {\n      \"target\": \"15-30 seconds\",\n      \"hook\": \"3-4 seconds\",\n      \"cta\": \"4-5 seconds\",\n      \"style\": \"Fast-paced, punchy, only the most critical selling points\"\n    },\n    \"system_prompt\": \"You are an expert TikTok car ad copywriter for Capitol Car Credit, a dealership in Rantoul, Illinois.\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nâ±ï¸ SCRIPT LENGTH TARGET: 15-30 seconds\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nPACING: Fast-paced, punchy, only the most critical selling points\\nHook: 3-4 seconds\\nCall to Action: 4-5 seconds\\n\\nCRITICAL: Your script MUST fit within the 15-30 seconds time frame when spoken naturally.\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¯ YOUR TOP 3 PRIORITIES (ALWAYS EMPHASIZE IN THIS ORDER):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\n1. PRICE - Specific prices, savings, deals, value for money\\n   - Mention actual prices clearly\\n   - Use \\\"Just [price]\\\" for under $20K to emphasize affordability\\n   - Make it sound like a great deal\\n\\n2. SELECTION - Show variety and options\\n   - Multiple vehicle types available\\n   - Something for everyone\\n   - Wide range to choose from\\n\\n3. FINANCING - Available for qualified buyers (THIS IS A HUGE DRAW!)\\n   - Mention financing naturally in CTA when possible\\n   - Use legally compliant language ONLY\\n   - Help buyers see ownership is possible\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ‘¥ TARGET AUDIENCE:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nFirst-time buyers, young professionals (18-30), and budget-conscious families\\n\\nTHEIR PRIORITIES (based on market research):\\n- Affordability and value (PRICE matters most!)\\n- Fuel efficiency (56% of buyers say this is #1 priority)\\n- Safety features (55% prioritize this - especially families with kids)\\n- Reliability and low maintenance\\n- Modern tech features (smartphone integration, backup camera)\\n- Practical benefits (AWD for winters, cargo space)\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ™ï¸ TEXT-TO-SPEECH FORMATTING (CRITICAL):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nNUMBERS:\\n- Write as words: \\\"twenty-one thousand\\\" not \\\"$21,000\\\"\\n- Years: \\\"twenty twenty-four\\\" not \\\"2024\\\"\\n- Abbreviations: \\\"all-wheel drive\\\" not \\\"AWD\\\"\\n- Write for natural speech, not reading\\n\\nPRICE FORMATTING:\\nUnder $20,000:\\n  - ALWAYS use \\\"Just\\\" before price (emphasizes value/affordability)\\n  - Examples: \\\"Just fourteen nine nine five\\\", \\\"Just seventeen thousand\\\"\\n\\n$20,000 and above:\\n  - ALWAYS include \\\"thousand\\\" (avoids confusion)\\n  - Examples: \\\"Twenty-one thousand\\\", \\\"Forty-eight thousand nine ninety-five\\\"\\n  - NEVER: \\\"twenty-one nine nine five\\\" (confusing without context)\\n\\nDO NOT MENTION:\\n- Mileage (displayed on screen)\\n- Complex technical specs (keep it simple)\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¯ FEATURE SELECTION PRIORITY:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nPick the HIGHEST tier feature available for each vehicle.\\n\\nTIER 1 - VALUE & AFFORDABILITY (mention FIRST):\\n  - Low Mileage: \\\"Only XX thousand miles!\\\" or \\\"Just XX thousand miles!\\\"\\n  - Fuel Efficiency: \\\"Great gas mileage\\\", \\\"Save at the pump\\\", \\\"Hybrid power\\\"\\n  - Reliable Brand: \\\"Reliable Toyota/Honda/Acura\\\"\\n  - Great Price: Emphasize value\\n\\nTIER 2 - SAFETY (frame with FAMILY PROTECTION):\\n  âš ï¸ IMPORTANT: Safety features should emphasize protecting loved ones!\\n\\n  - Camera: Multi-View â†’ \\\"Three-sixty camera keeps your family safe\\\"\\n  - Blind-Spot Information System â†’ \\\"Protect your loved ones with blind spot monitoring\\\"\\n  - Lane Departure Warning â†’ \\\"Keep your kids safe with lane keeping assist\\\"\\n  - Parking Sensors â†’ \\\"Park with confidence - front and rear sensors\\\"\\n  - Adaptive Cruise Control â†’ \\\"Safer highway driving for family road trips\\\"\\n  - Backup Camera â†’ \\\"See what's behind you to protect your family\\\"\\n  - Collision Warning â†’ \\\"Advanced safety to keep everyone safe\\\"\\n\\nTIER 3 - DESIRABILITY & PRACTICALITY (high-appeal features):\\n  - Power Moonroof/Sunroof â†’ \\\"Enjoy the open air!\\\" (young buyers love this!)\\n  - Heated Seats â†’ \\\"Stay warm in Illinois winters\\\"\\n  - Third Row Seating â†’ \\\"Room for the whole family\\\" or \\\"Seats seven\\\"\\n  - AWD/4X4 â†’ \\\"Handle any weather with all-wheel drive\\\"\\n  - Apple CarPlay/Android Auto â†’ \\\"Stay connected on the go\\\"\\n  - Spacious Cargo â†’ \\\"Plenty of room for gear\\\"\\n\\nTIER 4 - COMFORT BONUSES:\\n  - Power Liftgate â†’ \\\"Easy loading\\\"\\n  - Navigation System â†’ \\\"Never get lost\\\"\\n  - Premium Sound â†’ \\\"Concert-quality audio\\\"\\n  - LED Headlamps â†’ \\\"Better visibility\\\"\\n  - Keyless Entry â†’ \\\"Modern convenience\\\"\\n  - Leather Seats â†’ \\\"Luxury interior\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ—£ï¸ BRAND PRONUNCIATIONS (CRITICAL - NEVER DEVIATE):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nâš ï¸ Hyundai â†’ ALWAYS \\\"Hunday\\\" (NEVER \\\"High-un-die\\\" or \\\"Hoon-die\\\")\\nâš ï¸ Nissan â†’ ALWAYS \\\"Neesawn\\\" (NEVER \\\"Niss-an\\\" or \\\"Knee-zon\\\" or \\\"Ni-Shuan\\\" or \\\"Niece-on\\\")\\n- Porsche â†’ \\\"Por-shuh\\\"\\n- Chevrolet â†’ \\\"Shevra-lay\\\"\\n- BMW â†’ \\\"B M W\\\" (with spaces)\\n- Mercedes-Benz â†’ \\\"Mer-say-deez Benz\\\"\\n- Mazda â†’ \\\"Moz-duh\\\" (not \\\"Maz-duh\\\")\\n- Kia Forte â†’ \\\"Kia Fortay\\\" (NEVER \\\"Kee-uh Fort\\\")\\n- Altima â†’ \\\"Al-tih-muh\\\" (NEVER \\\"All-tee-muh\\\")\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“ CUSTOM GUIDANCE RULES:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nFACTS (mention when relevant):\\n- Capitol Car Credit has been family-owned for over 20 years\\n- Gary is the owner and founded the dealership\\n- Gary Knight has over 50 years of experience in the automotive industry.\\n\\nPRONUNCIATIONS (always follow):\\n- Say Warsh, not wash\\n\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nâš–ï¸ LEGAL COMPLIANCE (CRITICAL):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nâŒ NEVER SAY:\\n- \\\"Guaranteed approval\\\"\\n- \\\"Anyone can get financed\\\"\\n- \\\"Bad credit? No problem!\\\"\\n- Any promise of financing approval\\n\\nâœ… INSTEAD USE:\\n- \\\"Financing available for qualified buyers\\\"\\n- \\\"Talk to us about financing options\\\"\\n- \\\"We work with you on financing\\\"\\n- \\\"Ask about our financing programs\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“ž DEALERSHIP CONTACT INFO:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nCapitol Car Credit\\n125 North Century Boulevard, Rantoul, Illinois 61866\\n\\nSales Phone: (217) 893-8232\\n\\nFOR TEXT-TO-SPEECH:\\n- Address: \\\"one twenty-five North Century Boulevard, Ran-tool\\\"\\n- Phone: \\\"two one seven, eight nine three, eight two three two\\\"\\n- Website: \\\"Capitol Car Credit dot com\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“¢ CALL TO ACTION REQUIREMENTS:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nMUST INCLUDE:\\n1. ONE contact method (phone OR address OR website - NOT all three!)\\n2. Natural transition phrase: \\\"Get it at\\\", \\\"Visit us at\\\", \\\"Head to\\\", \\\"Stop by\\\", \\\"Call us at\\\"\\n3. Mention financing when natural (strongly encouraged - it's a big draw!)\\n\\nCTA EXAMPLES (WITH FINANCING):\\nâœ… \\\"Get it at Capitol Car Credit in Ran-tool - financing available for qualified buyers!\\\"\\nâœ… \\\"Visit Capitol Car Credit dot com - we'll work with you on financing!\\\"\\nâœ… \\\"Stop by one twenty-five North Century in Ran-tool - talk to us about financing!\\\"\\nâœ… \\\"Call two one seven, eight nine three, eight two three two - financing programs available!\\\"\\n\\nCTA EXAMPLES (WITHOUT FINANCING - still okay):\\nâœ… \\\"Head to Capitol Car Credit in Ran-tool today!\\\"\\nâœ… \\\"Visit us at one twenty-five North Century Boulevard!\\\"\\n\\nâŒ BAD EXAMPLES:\\n- Too much info: \\\"Visit us at 125 N Century Blvd, call 217-893-8232, or go to CapitolCarCredit.com!\\\"\\n- Too pushy: \\\"Bad credit? No problem! Everyone approved!\\\"\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¨ THEME HANDLING (when provided by user):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nIf a THEME is provided:\\n- Use it in the HOOK (opening sentence) and, optionally, in the segments and CTA if time allows\\n- Make the hook tie naturally into the theme\\n- Examples:\\n  * Theme \\\"Black Friday\\\" â†’ \\\"Black Friday deals are here at Capitol Car Credit!\\\"\\n  * Theme \\\"Winter weather\\\" â†’ \\\"Ready for Illinois winters? We've got you covered!\\\"\\n  * Theme \\\"First-time buyers\\\" â†’ \\\"First car? We make it easy!\\\"\\n\\nIf NO theme provided:\\n- Use a generic attention-grabber about value/selection/deals\\n- Examples: \\\"Check out these deals!\\\", \\\"Selection is hot right now!\\\"\\n\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸ“‹ OUTPUT FORMAT (JSON):\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\n{\\n  \\\"hook\\\": \\\"Opening sentence (3-4 seconds)\\\",\\n  \\\"segments\\\": [\\n    \\\"Segment 1 (timing varies by template)\\\",\\n    \\\"Segment 2\\\",\\n    ...\\n  ],\\n  \\\"cta\\\": \\\"Call to action with ONE contact method + optional financing mention (4-5 seconds)\\\",\\n  \\\"full_script\\\": \\\"Complete script: hook + all segments + cta\\\",\\n  \\\"notes\\\": \\\"Brief creative notes\\\"\\n}\\n\\nCRITICAL FORMATTING:\\n- \\\"segments\\\" array = core content (varies by template type)\\n- ALWAYS end full_script with a pause.\\n- This allows avatar to return to resting face before video cuts\\n- Output ONLY valid JSON (no markdown, no backticks)\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸŽ¯ REMEMBER THE BIG 3:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nEvery script should emphasize:\\n1. PRICE - Specific, clear, sounds like a deal\\n2. SELECTION - Variety and options available\\n3. FINANCING - Available for qualified buyers (mention when natural!)\\n\\nThis is what sets Capitol Car Credit apart!\\n\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\nðŸš— MULTI-CAR AD SPECIFIC RULES:\\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\\n\\nSTYLE: FAST, PUNCHY, SCROLL-STOPPING\\nSCRIPT LENGTH: 15-30 seconds\\n\\nTIMING TARGETS FOR 5 VEHICLE(S):\\n- Hook: 3-4 seconds\\n- Each vehicle segment: 3-4 seconds each\\n- CTA: 4-5 seconds\\n- Total target: 21-24 seconds\\n\\nPACING: Fast-paced, punchy, only the most critical selling points\\n\\nSCRIPT STRUCTURE:\\n1. HOOK (3-4 seconds): ONE punchy sentence that grabs attention\\n2. SEGMENTS - ONE PER CAR (3-4 seconds each): Price + ONE killer feature\\n3. CTA (4-5 seconds): Dealership name + ONE contact method (address, phone number, or url) + financing mention\\n  - Examples:\\n    - URL: \\\"Find Capitol Car Credit's full inventory at C C Ran-tool dot com\\\"\\n    - ADDRESS: \\\"Visit us at Capitol Car Credit at one twenty five, North Century Boulevard in Ran-tool\\\"\\n    - PHONE NUMBER: \\\"Contact Capitol Car Credit at two one seven, eight nine three, eight two three two, we're waiting to hear from you!\\\"\\n\\nSTYLE GUIDE:\\nâœ… SHORT sentences (5-8 words max per sentence for quick, 8-12 for standard, 12-15 for detailed)\\nâœ… ONE feature per car\\nâœ… Fast-paced, energetic, value-focused\\nâœ… Price FIRST for each car\\nâœ… Emphasize VALUE: \\\"easy on your wallet\\\", \\\"great deal\\\", \\\"reliable\\\"\\n\\nâŒ NO long descriptions (unless detailed script)\\nâŒ NO multiple features per car (unless standard/detailed)\\nâŒ NO repetitive features across cars in same ad\\n\\nFEATURE DIVERSITY (CRITICAL):\\nâš ï¸ Use DIFFERENT features for each car in the ad!\\n\\nGOOD (varied): \\n- \\\"Just fourteen nine nine five for this low mileage Accord!\\\"\\n- \\\"Just seventeen thousand for this all-wheel drive Civic with heated seats!\\\" \\n- \\\"Just twelve nine ninety-five for this reliable Camry with great gas mileage!\\\"\\n\\nBAD (repetitive):\\n- \\\"Low mileage Accord!\\\"\\n- \\\"Low mileage Civic!\\\"\\n- \\\"Low mileage Camry!\\\" â† BORING!\\n\\nIf multiple cars have the same top feature, pick the NEXT BEST feature from a different tier.\",\n    \"user_prompt\": \"Generate a 15-30 seconds script for this TikTok car ad:\\n\\nTHEME: Tax Refund Car Planning\\n\\nVEHICLES (5 total):\\n\\n1. 2018 Chevrolet Silverado 1500 4WD\\n   Price: $27,995 (Use: \\\"[price] thousand\\\")\\n   TOP Features: V8 EcoTec3 5.3 Liter, 4WD, GRAY\\n   (Pick ONE - make sure each car gets a DIFFERENT feature!)\\n\\n2. 2019 Ram 1500 Classic 4WD\\n   Price: $29,995 (Use: \\\"[price] thousand\\\")\\n   TOP Features: V8 HEMI 5.7 Liter, 4WD, BLACK\\n   (Pick ONE - make sure each car gets a DIFFERENT feature!)\\n\\n3. 2018 Jeep Grand Cherokee\\n   Price: $18,995 (Use: \\\"Just [price]\\\")\\n   TOP Features: V6 VVT 3.6 Liter, 4WD, BLUE\\n   (Pick ONE - make sure each car gets a DIFFERENT feature!)\\n\\n4. 2021 Hyundai Sonata\\n   Price: $16,995 (Use: \\\"Just [price]\\\")\\n   TOP Features: 4-Cyl 2.5 Liter, FWD, BLUE\\n   (Pick ONE - make sure each car gets a DIFFERENT feature!)\\n\\n5. 2017 Chevrolet Equinox\\n   Price: $13,995 (Use: \\\"Just [price]\\\")\\n   TOP Features: 4-Cyl 2.4 Liter, FWD, WHITE\\n   (Pick ONE - make sure each car gets a DIFFERENT feature!)\\n\\nREQUIREMENTS:\\n1. Hook: ONE punchy sentence (theme: \\\"Tax Refund Car Planning\\\") (3-4 seconds)\\n2. Each car segment: Price + ONE feature (3-4 seconds each)\\n3. CTA: Transition phrase + dealership + ONE contact (phone number, url, or address) + financing mention (4-5 seconds)\\n4. Target length: 21-24 seconds\\n5. Pacing: Fast-paced, punchy, only the most critical selling points\\n6. âš ï¸ CRITICAL: Use DIFFERENT features for each car! Variety keeps it interesting!\\n7. END with \\\"...\\\" for avatar resting face\\n\\nOUTPUT AS JSON:\\n{\\n  \\\"hook\\\": \\\"ONE punchy sentence here\\\",\\n  \\\"segments\\\": [\\n    \\\"2018 Chevrolet description (3-4 seconds each)\\\",\\n    \\\"2019 Ram description (3-4 seconds each)\\\",\\n    \\\"2018 Jeep description (3-4 seconds each)\\\",\\n    \\\"2021 Hyundai description (3-4 seconds each)\\\",\\n    \\\"2017 Chevrolet description (3-4 seconds each)\\\"\\n  ],\\n  \\\"cta\\\": \\\"Call to action with ONE contact + financing mention\\\",\\n  \\\"full_script\\\": \\\"hook + all segments + cta\\\",\\n  \\\"notes\\\": \\\"Your notes\\\"\\n}\\n\\nRemember: Fast-paced, punchy, only the most critical selling points, DIFFERENT features per car, PROPER price formatting, CORRECT brand pronunciations, MENTION FINANCING!\",\n    \"target_duration\": \"21-24 seconds\",\n    \"text\": \"Tax refund seasonâ€™s coming â€” nowâ€™s the time to start thinking about your next car. Need a truck? This Silverado has a powerful V8 and four-wheel drive â€” ready for work or winter. Or this Ram 1500 â€” legendary HEMI power and a solid, dependable ride. Looking for an SUV? This Grand Cherokee handles Illinois weather with comfort and confidence. Need something practical? This Sonata is reliable, efficient, and easy on your budget. Or this Equinox â€” a great family SUV with room, safety, and everyday comfort. When youâ€™re ready, check out CCRantoul.com â€” weâ€™ll help you plan it the right way. Financing available for qualified buyers!\",\n    \"audio_url\": \"https://resource2.heygen.ai/text_to_speech/9d1d4cfe12b842308662754fabe57f18/f6d15141c0f74f99b855786e6c964b48/id=bb76fe24-a3e2-482f-80e5-0c903e5d21fe.wav\",\n    \"_section_timings\": [\n      {\n        \"name\": \"hook\",\n        \"start\": 0.179,\n        \"end\": 4.9,\n        \"duration\": 4.721\n      },\n      {\n        \"name\": \"segment_0\",\n        \"start\": 5.099,\n        \"end\": 11.139,\n        \"duration\": 6.039999999999999\n      },\n      {\n        \"name\": \"segment_1\",\n        \"start\": 11.519,\n        \"end\": 17.079,\n        \"duration\": 5.5600000000000005\n      },\n      {\n        \"name\": \"segment_2\",\n        \"start\": 17.44,\n        \"end\": 23.399,\n        \"duration\": 5.959\n      },\n      {\n        \"name\": \"segment_3\",\n        \"start\": 23.859,\n        \"end\": 29.559,\n        \"duration\": 5.699999999999999\n      },\n      {\n        \"name\": \"segment_4\",\n        \"start\": 30,\n        \"end\": 35.379,\n        \"duration\": 5.378999999999998\n      },\n      {\n        \"name\": \"cta\",\n        \"start\": 35.419,\n        \"end\": 43.119,\n        \"duration\": 7.700000000000003\n      }\n    ],\n    \"avatar_video_url\": \"https://files2.heygen.ai/aws_pacific/avatar_tmp/9d1d4cfe12b842308662754fabe57f18/31e6c0354ee34e71bd425ff40a4a4116.mp4?Expires=1768246066&Signature=J5ElFisO2oyfIB66YGnu3DSW1dq2vQSGb7QvcSqFlGhvCmaGMr6HxXSw9T~sZUaUmSz0rctMwOxvHdp18Wch1auLKCyqjhRpeyxfi6uyfOgePUHv74WvVHZvDH-7I0Ene61~svqGE2vC5Beuyg7gay8vo4hdhXd0QiyvqbK0oXlacVFZgHDCLoUhTYDTTB9rRkt9gK56xfp653oOH9HP1XfQSLRkzJGp8cl8RFUr81Z1-tvH3fRtXfak3QU~phinan5Dm2D1JE51J~PRarOR5DlTw4fgf0hMYgCeih2X8iLheL3XabMKQrsOf5dN4Wwu-4Ngcw6Hgg5WaNMhTbaJ-Q__&Key-Pair-Id=K38HBHX5LX3X2H\",\n    \"avatar_video_duration\": 43.3633,\n    \"avatar_mask_video_url\": \"https://res.cloudinary.com/dtpqxuwby/video/upload/v1767652628/replicate-prediction-q3djfzqr9nrmr0cvj158b0zk9m_balwfz.mp4\"\n  }\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -368,
        -128
      ],
      "id": "60798cb7-eaed-47ea-9ce3-b59a10cb4c41",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// Get all items coming into aggregate\nconst allItems = $input.all();\n\n// Get base config from Process All Vehicles\nconst baseConfig = $('Process All Vehicles').first().json;\nconst cachedVehicles = baseConfig.cachedVehicles || [];\nconst originalVehicles = baseConfig.vehicles || [];\n\nconsole.log(`Aggregate: Processing ${allItems.length} items`);\n\n// Process items from removebg/cloudinary flow\nconst processedVehicles = allItems\n  .filter(item => item.json.public_id && item.json.secure_url)\n  .map(item => {\n    const vin = item.json.public_id;\n    \n    // Find the original vehicle data to merge with\n    const originalVehicle = originalVehicles.find(v => v.vin === vin);\n    \n    if (!originalVehicle) {\n      console.warn(`âš ï¸ No original vehicle found for VIN ${vin}`);\n      return null;\n    }\n    return {\n      ...originalVehicle,  // â† Keep all original vehicle data\n      photo_url: item.json.secure_url  // â† Add Cloudinary URL\n    };\n  })\n  .filter(Boolean); // Remove any nulls\n\n// Create lookup maps by VIN\nconst processedByVin = {};\nprocessedVehicles.forEach(v => {\n  processedByVin[v.vin] = v;\n});\n\nconst cachedByVin = {};\ncachedVehicles.forEach(v => {\n  cachedByVin[v.vin] = v;\n});\n\n// Rebuild vehicles array in ORIGINAL order\nconst finalVehicles = originalVehicles.map(originalVehicle => {\n  const vin = originalVehicle.vin;\n  \n  // Use processed or cached version if available, otherwise original\n  return processedByVin[vin] || cachedByVin[vin] || originalVehicle;\n});\n\nconsole.log(`âœ“ Total: ${finalVehicles.length} vehicles in correct order`);\n\n// Clean config\nconst { vehiclesToProcess, cachedVehicles: _, ...cleanConfig } = baseConfig;\n\nreturn [{\n  json: {\n    ...cleanConfig,\n    vehicles: finalVehicles\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -496,
        96
      ],
      "id": "6be976a7-570a-494c-b41c-72e758ede38f",
      "name": "Aggregate Vehicles"
    },
    {
      "parameters": {
        "jsCode": "return $input.all();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -336,
        96
      ],
      "id": "5df931bc-a974-4b08-88f6-d6006b054fc2",
      "name": "Aggregate Configs"
    },
    {
      "parameters": {
        "jsCode": "// Single error - format it for the email\nconst error = $input.first().json;\nconst nodeName = error.node?.name || 'Unknown node';\n\n// Handle different error formats from different APIs\nlet errorMsg = 'Unknown error';\n\n// Cloudinary error format: { \"error\": { \"message\": \"...\" } }\nif (error.error?.message) {\n  errorMsg = error.error.message;\n}\n// Creatomate error format: { \"status\": \"failed\", \"error_message\": \"...\" }\nif (error.error_message) {\n  errorMsg = error.error_message;\n}\n  \n// Remove.bg error format: { \"errors\": [{ \"code\": \"...\", \"title\": \"...\" }] }\nelse if (error.errors && Array.isArray(error.errors) && error.errors.length > 0) {\n  const firstError = error.errors[0];\n  // Include code if present, otherwise just title\n  errorMsg = firstError.code \n    ? `${firstError.code}: ${firstError.title}` \n    : firstError.title;\n}\n// Creatomate error format: { \"error_message\": \"...\" }\nelse if (error.error_message) {\n  errorMsg = error.error_message;\n}\n// Generic message fallback\nelse if (error.message) {\n  errorMsg = error.message;\n}\n\nreturn [{\n  json: {\n    nodeName: nodeName,\n    errorMessage: errorMsg,\n    timestamp: new Date().toISOString(),\n    rawError: JSON.stringify(error, null, 2) // Include full error for debugging\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        -96
      ],
      "id": "784d6524-d4b7-4640-b0f1-2467d38dcf9a",
      "name": "Format Node Error"
    },
    {
      "parameters": {
        "content": "# #3 Generate Video",
        "height": 720,
        "width": 1824,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -560,
        -272
      ],
      "typeVersion": 1,
      "id": "cfb457e3-4e30-4045-916a-2c45b78a2cbf",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -544,
        -128
      ],
      "id": "febf4365-88f4-4424-a9d1-ab1dafbe1e95",
      "name": "When Executed by Orchestrate Video Creation"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "78c8847d-ded2-428b-b6d2-8b59e006a8aa",
              "leftValue": "={{ $json.vehiclesToProcess.length}}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -80,
        -128
      ],
      "id": "d3c49706-9898-4e26-9cb1-65ebf9239b23",
      "name": "If: Has Vehicles"
    },
    {
      "parameters": {
        "jsCode": "const vehiclesToProcess = $json.vehiclesToProcess || [];\n\nreturn vehiclesToProcess.map(vehicle => ({\n  json: vehicle\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80,
        -144
      ],
      "id": "cabf3be1-d71f-4d05-a6fb-bd60c6480d77",
      "name": "Send Only Vehicles to Process"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.remove.bg/v1.0/removebg",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "72rkEtm8QRzFpqEmjL42o89z"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"image_url\": \"{{ $json.photo_url || $json.image_url }}\",\n  \"size\": \"auto\",\n  \"format\": \"png\",\n  \"crop\": true,\n  \"crop_margin\": \"10%\"\n}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        240,
        -144
      ],
      "id": "d4ecef3b-4065-44b9-b76e-95c1be44b7ac",
      "name": "API: Remove.bg",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.cloudinary.com/v1_1/dtpqxuwby/image/upload",
        "sendBody": true,
        "contentType": "multipart-form-data",
        "bodyParameters": {
          "parameters": [
            {
              "parameterType": "formBinaryData",
              "name": "file",
              "inputDataFieldName": "data"
            },
            {
              "name": "upload_preset",
              "value": "n8n_unsigned"
            },
            {
              "name": "public_id",
              "value": "={{ $json.vin }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        544,
        -160
      ],
      "id": "969b1d09-908b-449f-b35d-0404ea08d0dd",
      "name": "API: Cloudinary, Upload",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "cc7c4fae-f404-4b50-b3e0-a86a35ad1403",
              "leftValue": "={{ $json.api_creatomate_create_video }}",
              "rightValue": "true",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        32,
        96
      ],
      "id": "e31917be-d832-4f23-9f3a-8dfd718a570c",
      "name": "If: Test, Skip Video Creation"
    },
    {
      "parameters": {
        "jsCode": "return [{\n  json: $json.api_creatomate_create_video\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        368,
        32
      ],
      "id": "aa6dce6f-6e60-452b-a4aa-4a90ebd7214d",
      "name": "Skip Video Creation"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "b0d1a7bf-ac65-4401-bf77-dc691de54791",
              "leftValue": "={{ $json.status }}",
              "rightValue": "succeeded",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        720,
        128
      ],
      "id": "cdc69818-5724-4f8c-ae10-d81bdabc5677",
      "name": "If: Succeeded?"
    },
    {
      "parameters": {
        "jsCode": "const apiResponse = $json;\nconst config = $('Aggregate Configs').first().json;\nconst videoUrl = apiResponse.url;\nconst videoDuration = apiResponse.duration;\n\nif (!videoUrl) {\n  throw new Error('Creatomate did not return a video URL');\n}\n\nreturn [{\n  json: {\n    ...config,  // â† Preserves ALL previous api_* keys!\n    \n    // new\n    final_video_url: videoUrl,\n    video_duration: videoDuration,\n    \n    // Testing API Response\n    ...(config.test_mode && { api_creatomate_create_video: apiResponse })\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        112
      ],
      "id": "94a3f672-71bd-4b34-a989-262f4bef3c0e",
      "name": "Parse Video Creation Response"
    },
    {
      "parameters": {
        "url": "=https://api.creatomate.com/v1/renders/{{ $json.id }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 754b059fc6f045ea9f16cbbdacd691bec27dec04525ad3a8a0d7cdf74136980793efce4b8aafee5312b097973d74b0a4"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        528,
        144
      ],
      "id": "cfbd1219-c74c-4024-9f11-0aef6b6c211b",
      "name": "API: Creatomate, Check Status",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.creatomate.com/v1/renders",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 754b059fc6f045ea9f16cbbdacd691bec27dec04525ad3a8a0d7cdf74136980793efce4b8aafee5312b097973d74b0a4"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json.creatomate }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        176,
        176
      ],
      "id": "3e365a4a-5fa9-4942-827f-6f51a60a38c7",
      "name": "API: Creatomate, Create Video",
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "// Get the VIN from your JSON data\nconst vin = $json.vin;\n\n// Get the binary item properly\nconst binaryData = $input.item.binary?.data;\n\nif (!binaryData) {\n  throw new Error('No binary data found');\n}\n\n// Return with renamed file - use $input.item.binary to preserve the actual data\nreturn {\n  json: $json,\n  binary: {\n    data: {\n      ...binaryData,\n      fileName: `${vin}.png`\n    }\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        -160
      ],
      "id": "dcdd5c0b-9198-468f-a2f2-d28e3341212e",
      "name": "Parse Remove.bg"
    },
    {
      "parameters": {
        "mode": "runOnceForEachItem",
        "jsCode": "return (async () => {\n\n// Unified Build Template JSON node\n// Fetches template by tag, modifies source in-place, returns full source for render\n\nconst config = $json;\n\n// ============================================\n// STEP 1: Determine Template Tag\n// ============================================\nconst clientId = (config.client || 'ccc').toUpperCase();\nconst templateId = config.template_id || 'ad-multi-item-1';\nconst ratio = config.ratio || '9:16';\n\n// Convert template_id to tag format\n// \"ad-multi-item-1\" â†’ \"AD_MULTI-ITEM-1\"\nconst templateTag = templateId.toUpperCase().replace(/-/, '_');\nconst uniqueTag = `${clientId}_${templateTag}_${ratio}`;\n\nconsole.log(`ðŸ·ï¸ Fetching template with tag: ${uniqueTag}`);\n\n// ============================================\n// STEP 2: Fetch Template from Creatomate\n// ============================================\nconst apiKey = '754b059fc6f045ea9f16cbbdacd691bec27dec04525ad3a8a0d7cdf74136980793efce4b8aafee5312b097973d74b0a4';\n\n// Step 1: Find template by tag (returns id, name, tags - but NOT source)\nconst templateList = await this.helpers.httpRequest({\n  method: 'GET',\n  url: `https://api.creatomate.com/v1/templates?tags=${encodeURIComponent(uniqueTag)}`,\n  headers: {\n    'Authorization': `Bearer ${apiKey}`\n  },\n  json: true\n});\n\nif (!templateList || !Array.isArray(templateList) || templateList.length === 0) {\n  throw new Error(`No template found with tag: ${uniqueTag}`);\n}\n\nconst templateInfo = templateList[0];\nconsole.log(`ðŸ“ Found template: ${templateInfo.name} (ID: ${templateInfo.id})`);\n\n// Step 2: Fetch full template by ID (this returns the source)\nconst template = await this.helpers.httpRequest({\n  method: 'GET',\n  url: `https://api.creatomate.com/v1/templates/${templateInfo.id}`,\n  headers: {\n    'Authorization': `Bearer ${apiKey}`\n  },\n  json: true\n});\n\nif (!template.source) {\n  throw new Error(`Template ${template.id} has no source property`);\n}\n\n// Deep clone the source\nconst source = JSON.parse(JSON.stringify(template.source));\n\nconsole.log(`âœ… Loaded template source (${Object.keys(template.source).length} top-level keys)`);\n\n// ============================================\n// STEP 3: Build Swap Config from Incoming Data\n// ============================================\n\n// Platform info\nconst platformInput = (config.platform || 'tiktok').toLowerCase();\nconst basePlatform = platformInput.split('-')[0];\nconst avatarName = config.avatar_name || 'SHAD';\n\n// Platform banner text\nconst platformTexts = {\n  'tiktok': `Ask for ${avatarName} and mention you saw this on TIKTOK!`,\n  'youtube': `Ask for ${avatarName} and mention you saw this on YOUTUBE!`,\n  'instagram': `Ask for ${avatarName} and mention you saw this on INSTAGRAM!`,\n  'facebook': `Ask for ${avatarName} and mention you saw this on FACEBOOK!`,\n  'none': `Ask for ${avatarName} for a great deal!`\n};\nconst platformText = platformTexts[basePlatform] || platformTexts['none'];\n\n// Timing from _section_timings\nconst sectionTimings = config._section_timings || [];\nconst hookSection = sectionTimings.find(t => t.name === 'hook');\nconst ctaSection = sectionTimings.find(t => t.name === 'cta');\n\nconst hookEnd = hookSection?.end || 0;\nconst ctaStart = ctaSection?.start || 0;\nconst videoDuration = config.avatar_video_duration || ctaSection?.end || 30;\n\n// Vehicles\nconst vehicles = config.vehicles || [];\nconst heroVehicle = vehicles[0] || {};\n\n// Spotlight feature photos\nconst selectedPhotos = config.selected_photos || [];\nconst featurePhotos = selectedPhotos.slice(1, 6);\n\n// Price formatter\nfunction formatPrice(price) {\n  if (!price) return null;\n  let priceNum = price;\n  if (typeof price === 'string') {\n    priceNum = parseFloat(price.replace(/[^0-9.]/g, ''));\n  }\n  if (isNaN(priceNum)) return price;\n  return '$' + priceNum.toLocaleString('en-US', { maximumFractionDigits: 0 });\n}\n\n// Build swap config\nconst swapConfig = {\n  hookEnd,\n  ctaStart,\n  videoDuration,\n  platformText,\n  bgMusicSource: config.media?.music_url,\n  bgImageSource: config.background_image_url,\n  avatar1Source: config.avatar_video_url,\n  avatar1MaskSource: config.avatar_mask_video_url,\n  item0Source: heroVehicle.photo_url,\n  item0Title: heroVehicle.year && heroVehicle.make && heroVehicle.model\n    ? `${heroVehicle.year} ${heroVehicle.make} ${heroVehicle.model}` : null,\n  item0Price: formatPrice(heroVehicle.price),\n  videoThumbnailText: config.script?.hook || config.topic || '',\n};\n\n// Spotlight features\nfeaturePhotos.forEach((photo, index) => {\n  const featureNum = index + 1;\n  const segmentTiming = sectionTimings.find(t => t.name === `segment_${featureNum}`);\n  swapConfig[`item0Feature${featureNum}Source`] = photo?.photo_url;\n  swapConfig[`item0Feature${featureNum}Time`] = segmentTiming?.start;\n  swapConfig[`item0Feature${featureNum}Duration`] = segmentTiming?.duration;\n});\n\n// Multi-item vehicles\nvehicles.forEach((vehicle, index) => {\n  const itemNum = index + 1;\n  if (itemNum > 5) return;\n  const segmentTiming = sectionTimings.find(t => t.name === `segment_${index}`);\n  swapConfig[`item${itemNum}Source`] = vehicle.photo_url;\n  swapConfig[`item${itemNum}Title`] = vehicle.year && vehicle.make && vehicle.model\n    ? `${vehicle.year} ${vehicle.make} ${vehicle.model}` : null;\n  swapConfig[`item${itemNum}Price`] = formatPrice(vehicle.price);\n  swapConfig[`item${itemNum}Mileage`] = vehicle.mileage\n    ? `${Number(vehicle.mileage).toLocaleString('en-US')} mi` : null;\n  swapConfig[`item${itemNum}Time`] = segmentTiming?.start;\n  swapConfig[`item${itemNum}Duration`] = segmentTiming?.duration;\n  swapConfig[`item${itemNum}Visible`] = true;\n});\n\n// Mark unused slots\nfor (let i = vehicles.length + 1; i <= 5; i++) {\n  swapConfig[`item${i}Visible`] = false;\n}\n\nconsole.log(`ðŸ“‹ Config built for: ${templateId}`);\n\n// ============================================\n// STEP 4: Apply Swaps to Source\n// ============================================\n\nfunction applyScaleAnimTiming(element, cfg) {\n  if (!element.animations) return;\n  const scaleAnims = element.animations.filter(a => a.type === 'scale');\n  if (scaleAnims.length === 1 && cfg.hookEnd !== undefined) {\n    scaleAnims[0].time = cfg.hookEnd;\n  } else if (scaleAnims.length === 2) {\n    if (cfg.hookEnd !== undefined) scaleAnims[0].time = cfg.hookEnd;\n    if (cfg.ctaStart !== undefined) scaleAnims[1].time = cfg.ctaStart;\n  }\n}\n\nfunction applySwaps(element, cfg, parent = null) {\n  const name = element.name;\n\n  // Avatar\n  if (name?.match(/^avatar-(\\d+)$/i)) {\n    const n = RegExp.$1;\n    if (cfg[`avatar${n}Source`]) element.source = cfg[`avatar${n}Source`];\n    applyScaleAnimTiming(element, cfg);\n  }\n\n  // Avatar Mask Layer (for RVM alpha mask compositing)\n  if (name?.match(/^avatar-(\\d+)-mask$/)) {\n    const n = RegExp.$1;\n    if (cfg[`avatar${n}MaskSource`]) {\n      element.source = cfg[`avatar${n}MaskSource`];\n      console.log(`âœ“ Applied mask video to avatar-${n}-mask`);\n    }\n  }\n\n  // Item-0 (hero) scale animation\n  if (name === 'Item-0') {\n    applyScaleAnimTiming(element, cfg);\n  }\n\n  // Item-0 nested elements\n  if (name === 'photo' && parent === 'Item-0') {\n    if (cfg.item0Source) element.source = cfg.item0Source;\n  }\n  if (name === 'title' && parent === 'Item-0') {\n    if (cfg.item0Title) element.text = cfg.item0Title;\n  }\n  if (name === 'price' && parent === 'Item-0') {\n    if (cfg.item0Price) element.text = cfg.item0Price;\n  }\n\n  // Features inside Item-0\n  const featureMatch = name?.match(/^feature-(\\d+)$/);\n  if (featureMatch && parent === 'Item-0') {\n    const n = featureMatch[1];\n    if (cfg[`item0Feature${n}Source`]) element.source = cfg[`item0Feature${n}Source`];\n    if (cfg[`item0Feature${n}Time`] !== undefined) element.time = cfg[`item0Feature${n}Time`];\n    if (cfg[`item0Feature${n}Duration`] !== undefined) element.duration = cfg[`item0Feature${n}Duration`];\n  }\n\n  // Multi-item Items (1-5)\n  const itemMatch = name?.match(/^Item-(\\d+)$/);\n  if (itemMatch && itemMatch[1] !== '0') {\n    const n = itemMatch[1];\n    if (cfg[`item${n}Time`] !== undefined) element.time = cfg[`item${n}Time`];\n    if (cfg[`item${n}Duration`] !== undefined) element.duration = cfg[`item${n}Duration`];\n    if (cfg[`item${n}Visible`] === false) element.visible = false;\n  }\n\n  // Multi-item nested elements\n  const parentItemMatch = parent?.match(/^Item-(\\d+)$/);\n  if (parentItemMatch && parentItemMatch[1] !== '0') {\n    const n = parentItemMatch[1];\n    if (name === 'photo' && cfg[`item${n}Source`]) element.source = cfg[`item${n}Source`];\n    if (name === 'title' && cfg[`item${n}Title`]) element.text = cfg[`item${n}Title`];\n    if (name === 'price' && cfg[`item${n}Price`]) element.text = cfg[`item${n}Price`];\n    if (name === 'mileage' && cfg[`item${n}Mileage`]) element.text = cfg[`item${n}Mileage`];\n  }\n\n  // Platform banner\n  if (name === 'platform-banner') {\n    if (cfg.platformText) element.text = cfg.platformText;\n    if (element.animations?.[0] && cfg.videoDuration) {\n      element.animations[0].duration = cfg.videoDuration;\n    }\n  }\n\n  // Company intro - duration matches hook\n  if (name === 'Company-Intro' || name === 'Contact-Info-intro') {\n    if (cfg.hookEnd !== undefined) element.duration = cfg.hookEnd;\n  }\n\n  // Company outro\n  if (name === 'Company-Outro') {\n    if (cfg.ctaStart !== undefined) element.time = cfg.ctaStart;\n  }\n\n  // Background music/image\n  if (name === 'background-music' && cfg.bgMusicSource) {\n    element.source = cfg.bgMusicSource;\n  }\n  if (name === 'background-image' && cfg.bgImageSource) {\n    element.source = cfg.bgImageSource;\n  }\n\n  // Educational video thumbnail\n  if (name === 'video-thumbnail' && cfg.videoThumbnailText) {\n    element.text = cfg.videoThumbnailText;\n  }\n\n  // Recurse\n  if (element.elements && Array.isArray(element.elements)) {\n    element.elements.forEach(child => applySwaps(child, cfg, name));\n  }\n}\n\n// Set top-level duration\nif (swapConfig.videoDuration) {\n  source.duration = swapConfig.videoDuration;\n}\n\n// Apply swaps recursively\nif (source.elements && Array.isArray(source.elements)) {\n  source.elements.forEach(element => applySwaps(element, swapConfig, null));\n}\n\nconsole.log(`âœ… Template modifications applied`);\n\n// ============================================\n// STEP 5: Return template_id + source for Creatomate\n// ============================================\n// Tested: Creatomate accepts both! This keeps template name in logs.\n\n// Clean swapConfig - remove undefined values for cleaner output\nconst cleanSwapConfig = Object.fromEntries(\n  Object.entries(swapConfig).filter(([_, v]) => v !== undefined)\n);\n\nconst output = {\n  ...config,\n  creatomate: {\n        source: source\n  },\n  _template_tag: uniqueTag,\n  _swap_config: cleanSwapConfig\n};\n\n// runOnceForEachItem mode: return single object, not array\nreturn {\n  json: JSON.parse(JSON.stringify(output))\n}\n\n})();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -176,
        96
      ],
      "id": "unified-build-template-json",
      "name": "Build Template JSON"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.resend.com/emails",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpBearerAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"from\": \"errors@ad-pilot.ai\",\n  \"to\": \"kelly@ad-pilot.ai\", \n  \"subject\": \"ðŸš¨ Video Generation Failed - {{ $json.nodeName }}\",\n  \"html\": \"âš ï¸ Video Creation Workflow Error<br/><br/>Failed Node: {{ $json.nodeName }}<br/>Error: {{ $json.errorMessage }}<br/><br/>Time: {{ $json.timestamp }}\"\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        976,
        -96
      ],
      "id": "5806628c-bf99-4c78-b44e-e563d2f56a37",
      "name": "Email Errors",
      "credentials": {
        "httpBearerAuth": {
          "id": "vdxOfyrKMfWKSmAH",
          "name": "Resend"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 3
          },
          "conditions": [
            {
              "id": "3f2511ab-5b89-4844-973a-9b615994e7b4",
              "leftValue": "={{$json.status}}",
              "rightValue": "failed",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.3,
      "position": [
        864,
        240
      ],
      "id": "236a86f6-9fb4-4fb5-aabd-3c81607721dd",
      "name": "If: Failed?"
    }
  ],
  "connections": {
    "Process All Vehicles": {
      "main": [
        [
          {
            "node": "If: Has Vehicles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Render": {
      "main": [
        [
          {
            "node": "API: Creatomate, Check Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Process All Vehicles",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Vehicles": {
      "main": [
        [
          {
            "node": "Aggregate Configs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate Configs": {
      "main": [
        [
          {
            "node": "Build Template JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Node Error": {
      "main": [
        [
          {
            "node": "Email Errors",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Orchestrate Video Creation": {
      "main": [
        []
      ]
    },
    "If: Has Vehicles": {
      "main": [
        [
          {
            "node": "Send Only Vehicles to Process",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Aggregate Configs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Only Vehicles to Process": {
      "main": [
        [
          {
            "node": "API: Remove.bg",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API: Remove.bg": {
      "main": [
        [
          {
            "node": "Parse Remove.bg",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Node Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API: Cloudinary, Upload": {
      "main": [
        [
          {
            "node": "Aggregate Vehicles",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Node Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Test, Skip Video Creation": {
      "main": [
        [
          {
            "node": "Skip Video Creation",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "API: Creatomate, Create Video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Skip Video Creation": {
      "main": [
        [
          {
            "node": "Parse Video Creation Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Succeeded?": {
      "main": [
        [
          {
            "node": "Parse Video Creation Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If: Failed?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Video Creation Response": {
      "main": [
        []
      ]
    },
    "API: Creatomate, Check Status": {
      "main": [
        [
          {
            "node": "If: Succeeded?",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Node Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "API: Creatomate, Create Video": {
      "main": [
        [
          {
            "node": "Wait for Render",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Format Node Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Remove.bg": {
      "main": [
        [
          {
            "node": "API: Cloudinary, Upload",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Template JSON": {
      "main": [
        [
          {
            "node": "If: Test, Skip Video Creation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Errors": {
      "main": [
        [
          {
            "node": "Stop and Error",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If: Failed?": {
      "main": [
        [
          {
            "node": "Format Node Error",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait for Render",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "availableInMCP": false
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "6cf52af9-eb77-4acd-89ab-b6066eafa4ca",
  "activeVersionId": null,
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-12-13T13:57:28.375Z",
      "createdAt": "2025-12-13T13:57:28.375Z",
      "role": "workflow:owner",
      "workflowId": "FOQ8foX33kSuaZEJ",
      "projectId": "VF66NQc9R74tCdyG"
    }
  ],
  "activeVersion": null,
  "tags": []
}