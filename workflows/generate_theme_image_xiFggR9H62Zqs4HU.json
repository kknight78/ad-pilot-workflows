{
  "updatedAt": "2025-11-13T13:46:01.000Z",
  "createdAt": "2025-10-20T22:00:45.574Z",
  "id": "xiFggR9H62Zqs4HU",
  "name": "Generate Theme Image",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "inputSource": "passthrough"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -1968,
        224
      ],
      "id": "b5a33847-6986-4b01-bcfa-9b12f0898dfa",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "jsCode": "// Get all the config data from trigger\nconst config = $input.first().json;\nconst theme = config.theme || \"car sale\";\n\nconst prompt = `You are creating a 2-3 second animated hook for a TikTok car ad.\n\nTHEME: ${theme}\n\nGenerate a VERY SHORT animation prompt (MAX 400 characters) for an AI animation generator in \"Garbage Pail Kids\" wacky cartoon style.\n\nCRITICAL RULES:\n1. MAX 400 CHARACTERS TOTAL - Be extremely concise\n2. ONE simple character doing ONE action\n3. Character uses ONLY: red, yellow, orange, blue, purple colors\n4. ABSOLUTELY NO GREEN on the character (background is green screen)\n5. NO extra elements (no sparkles, confetti, text, etc.)\n6. Full body visible, centered\n7. Solid flat green background #00FF00\n\nFORMAT (use this exact structure):\n\"Wacky [character] in Garbage Pail Kids style with exaggerated features, doing [ONE action], character uses red/yellow/orange/blue/purple colors with zero green, full body visible, weird fun art style, solid flat green background #00FF00\"\n\nKeep it under 400 characters. Be specific but concise.`;\n\n// Build the Claude API request body\nconst claudeBody = {\n  model: \"claude-sonnet-4-20250514\",\n  max_tokens: 500,\n  messages: [\n    {\n      role: \"user\",\n      content: prompt\n    }\n  ]\n};\n\n// ALWAYS return full config + new fields\nreturn [{\n  json: {\n    ...config,  // ✅ Pass through ALL config\n    _claude_body: claudeBody,\n    _claude_prompt: prompt\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1520,
        224
      ],
      "id": "191e5a2e-4c7c-465d-86f8-eb3297decd62",
      "name": "Build Claude Prompt"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "status-check",
              "leftValue": "={{ $json.status }}",
              "rightValue": "complete",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        256,
        224
      ],
      "id": "65dff53b-aee6-4b51-8702-7c6c57614367",
      "name": "Is Generation Complete?"
    },
    {
      "parameters": {
        "amount": 15
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        736,
        528
      ],
      "id": "4a30bb17-0681-4014-864b-987dcc2263d2",
      "name": "Wait for Generation",
      "webhookId": "58f434a2-77e6-4a74-aa65-38a6c580bd28"
    },
    {
      "parameters": {
        "mode": "raw",
        "jsonOutput": "\n  {\n    \"model\": \"claude-sonnet-4-20250514\",\n    \"id\": \"msg_01Mki2Sx9yazso1myCNqqkSb\",\n    \"type\": \"message\",\n    \"role\": \"assistant\",\n    \"content\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"```json\\n{\\n  \\\"hook\\\": \\\"When in Rome, drive like royalty!\\\",\\n  \\\"cars\\\": [\\n    \\\"Seventeen nine nine five for this twenty seventeen Honda Accord with smooth automatic transmission!\\\",\\n    \\\"Twenty-four nine nine five gets you this twenty twenty-one Toyota Tacoma truck!\\\",\\n    \\\"Thirty-four nine nine five for this twenty twenty GMC Sierra with powerful four-wheel drive!\\\",\\n    \\\"Twenty-one nine nine five for this twenty twenty-three Chrysler Voyager with spacious family seating!\\\",\\n    \\\"Twenty-seven nine nine five gets you this brand new twenty twenty-four Shevra-lay Trailblazer!\\\"\\n  ],\\n  \\\"cta\\\": \\\"Capitol Car Credit! Call two one seven, eight nine three, eight two three two!\\\",\\n  \\\"full_script\\\": \\\"When in Rome, drive like royalty! Seventeen nine nine five for this twenty seventeen Honda Accord with smooth automatic transmission! Twenty-four nine nine five gets you this twenty twenty-one Toyota Tacoma truck! Thirty-four nine nine five for this twenty twenty GMC Sierra with powerful four-wheel drive! Twenty-one nine nine five for this twenty twenty-three Chrysler Voyager with spacious family seating! Twenty-seven nine nine five gets you this brand new twenty twenty-four Shevra-lay Trailblazer! Capitol Car Credit! Call two one seven, eight nine three, eight two three two!\\\",\\n  \\\"notes\\\": \\\"Rome theme connects luxury/royalty with car ownership. Selected best features: Accord's reliability via automatic, Tacoma's truck utility, Sierra's 4WD capability, Voyager's family space, Trailblazer's newness. Fast-paced with clear pricing structure.\\\"\\n}\\n```\"\n      }\n    ],\n    \"stop_reason\": \"end_turn\",\n    \"stop_sequence\": null,\n    \"usage\": {\n      \"input_tokens\": 1270,\n      \"cache_creation_input_tokens\": 0,\n      \"cache_read_input_tokens\": 0,\n      \"cache_creation\": {\n        \"ephemeral_5m_input_tokens\": 0,\n        \"ephemeral_1h_input_tokens\": 0\n      },\n      \"output_tokens\": 406,\n      \"service_tier\": \"standard\"\n    },\n    \"template_id\": \"TEMP_002\",\n    \"template_name\": \"Single-Car-Feature\",\n    \"duration_seconds\": 20,\n    \"aspect_ratio\": \"9:16\",\n    \"num_car_slots\": 1,\n    \"platform_primary\": \"TikTok\",\n    \"style_theme\": \"luxury\",\n    \"avatar_primary\": \"Dad\",\n    \"voiceover_style\": \"Professional\",\n    \"status\": \"active\",\n    \"notes\": \"Deep dive on premium vehicles\",\n    \"scenes\": [\n      {\n        \"scene\": 1,\n        \"duration\": 3,\n        \"description\": \"Hook - attention grabber\"\n      },\n      {\n        \"scene\": 2,\n        \"duration\": 12,\n        \"description\": \"Feature 1 cars with specs\"\n      },\n      {\n        \"scene\": 3,\n        \"duration\": 3,\n        \"description\": \"CTA with dealership info\"\n      }\n    ],\n    \"_input\": {\n      \"row_number\": 3,\n      \"Template_ID\": \"TEMP_002\",\n      \"Template_Name\": \"Single-Car-Feature\",\n      \"Duration_Seconds\": 20,\n      \"Aspect_Ratio\": \"9:16\",\n      \"Num_Car_Slots\": 1,\n      \"Platform_Primary\": \"TikTok\",\n      \"Style_Theme\": \"luxury\",\n      \"Music_Required\": \"yes\",\n      \"Avatar_Primary\": \"Dad\",\n      \"Avatar_Type\": \"Real_Person\",\n      \"Voiceover_Style\": \"Professional\",\n      \"Status\": \"active\",\n      \"Notes\": \"Deep dive on premium vehicles\",\n      \"headers\": {\n        \"host\": \"kelly-ads.app.n8n.cloud\",\n        \"user-agent\": \"Mozilla/5.0 (X11; CrOS x86_64 14541.0.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36\",\n        \"content-length\": \"325\",\n        \"accept\": \"*/*\",\n        \"accept-encoding\": \"gzip, br\",\n        \"accept-language\": \"en-US,en-GB;q=0.9,en;q=0.8\",\n        \"cdn-loop\": \"cloudflare; loops=1; subreqs=2\",\n        \"cf-connecting-ip\": \"2a06:98c0:3600::103\",\n        \"cf-ew-via\": \"14\",\n        \"cf-ipcountry\": \"US\",\n        \"cf-ray\": \"9912d523d18d000c-ORD\",\n        \"cf-visitor\": \"{\\\"scheme\\\":\\\"https\\\"}\",\n        \"cf-worker\": \"n8n.cloud\",\n        \"content-type\": \"application/json\",\n        \"priority\": \"u=1, i\",\n        \"x-forwarded-for\": \"2a06:98c0:3600::103, 172.70.126.172\",\n        \"x-forwarded-host\": \"kelly-ads.app.n8n.cloud\",\n        \"x-forwarded-port\": \"443\",\n        \"x-forwarded-proto\": \"https\",\n        \"x-forwarded-server\": \"traefik-prod-users-gwc-88-6587794787-z7mkt\",\n        \"x-is-trusted\": \"yes\",\n        \"x-proxy-service\": \"CloudflareWorkersCORS\",\n        \"x-real-ip\": \"2a06:98c0:3600::103\"\n      },\n      \"params\": {},\n      \"query\": {},\n      \"body\": {\n        \"template_id\": \"TEMP_002\",\n        \"theme\": \"when in rome\",\n        \"avatar_id\": \"229bfc03d4d24d5ab7a5c71ce4b10d4b\",\n        \"voice_id\": \"bWI0w7QVOZiBvlJQahML\",\n        \"chromakey_color\": \"#89be5a\",\n        \"chromakey_sensitivity\": \"22\",\n        \"email\": \"kelly@kellyrae.net\",\n        \"vins\": [\n          \"2C4RC1CG7PR550003\",\n          \"3TYRX5GN1MT006219\",\n          \"1GTU9DED5LZ182661\",\n          \"KL79MPSL1RB092746\",\n          \"1HGCR2F85HA017024\"\n        ]\n      },\n      \"webhookUrl\": \"https://kelly-ads.app.n8n.cloud/webhook/ad-pilot-draft\",\n      \"executionMode\": \"production\",\n      \"theme\": \"when in rome\",\n      \"email\": \"kelly@kellyrae.net\",\n      \"vins\": [\n        \"2C4RC1CG7PR550003\",\n        \"3TYRX5GN1MT006219\",\n        \"1GTU9DED5LZ182661\",\n        \"KL79MPSL1RB092746\",\n        \"1HGCR2F85HA017024\"\n      ],\n      \"template_id\": \"TEMP_002\",\n      \"avatar_id\": \"229bfc03d4d24d5ab7a5c71ce4b10d4b\",\n      \"voice_id\": \"bWI0w7QVOZiBvlJQahML\",\n      \"chromakey_color\": \"#89be5a\",\n      \"chromakey_sensitivity\": \"22\"\n    },\n    \"headers\": {\n      \"host\": \"kelly-ads.app.n8n.cloud\",\n      \"user-agent\": \"Mozilla/5.0 (X11; CrOS x86_64 14541.0.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36\",\n      \"content-length\": \"325\",\n      \"accept\": \"*/*\",\n      \"accept-encoding\": \"gzip, br\",\n      \"accept-language\": \"en-US,en-GB;q=0.9,en;q=0.8\",\n      \"cdn-loop\": \"cloudflare; loops=1; subreqs=2\",\n      \"cf-connecting-ip\": \"2a06:98c0:3600::103\",\n      \"cf-ew-via\": \"14\",\n      \"cf-ipcountry\": \"US\",\n      \"cf-ray\": \"9912d523d18d000c-ORD\",\n      \"cf-visitor\": \"{\\\"scheme\\\":\\\"https\\\"}\",\n      \"cf-worker\": \"n8n.cloud\",\n      \"content-type\": \"application/json\",\n      \"priority\": \"u=1, i\",\n      \"x-forwarded-for\": \"2a06:98c0:3600::103, 172.70.126.172\",\n      \"x-forwarded-host\": \"kelly-ads.app.n8n.cloud\",\n      \"x-forwarded-port\": \"443\",\n      \"x-forwarded-proto\": \"https\",\n      \"x-forwarded-server\": \"traefik-prod-users-gwc-88-6587794787-z7mkt\",\n      \"x-is-trusted\": \"yes\",\n      \"x-proxy-service\": \"CloudflareWorkersCORS\",\n      \"x-real-ip\": \"2a06:98c0:3600::103\"\n    },\n    \"params\": {},\n    \"query\": {},\n    \"body\": {\n      \"template_id\": \"TEMP_002\",\n      \"theme\": \"when in rome\",\n      \"avatar_id\": \"229bfc03d4d24d5ab7a5c71ce4b10d4b\",\n      \"voice_id\": \"bWI0w7QVOZiBvlJQahML\",\n      \"chromakey_color\": \"#89be5a\",\n      \"chromakey_sensitivity\": \"22\",\n      \"email\": \"kelly@kellyrae.net\",\n      \"vins\": [\n        \"2C4RC1CG7PR550003\",\n        \"3TYRX5GN1MT006219\",\n        \"1GTU9DED5LZ182661\",\n        \"KL79MPSL1RB092746\",\n        \"1HGCR2F85HA017024\"\n      ]\n    },\n    \"webhookUrl\": \"https://kelly-ads.app.n8n.cloud/webhook/ad-pilot-draft\",\n    \"executionMode\": \"production\",\n    \"theme\": \"when in rome\",\n    \"email\": \"kelly@kellyrae.net\",\n    \"vins\": [\n      \"2C4RC1CG7PR550003\",\n      \"3TYRX5GN1MT006219\",\n      \"1GTU9DED5LZ182661\",\n      \"KL79MPSL1RB092746\",\n      \"1HGCR2F85HA017024\"\n    ],\n    \"avatar_id\": \"229bfc03d4d24d5ab7a5c71ce4b10d4b\",\n    \"voice_id\": \"bWI0w7QVOZiBvlJQahML\",\n    \"chromakey_color\": \"#89be5a\",\n    \"chromakey_sensitivity\": \"22\",\n    \"vehicles\": [\n      {\n        \"vin\": \"1HGCR2F85HA017024\",\n        \"year\": \"2017\",\n        \"make\": \"Honda\",\n        \"model\": \"Accord Sedan\",\n        \"price\": \"17995 USD\",\n        \"mileage\": \"98813\",\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/ed566e953b486ee090595aa16aa6b80f.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91168\",\n        \"features\": [\n          \"Automatic\",\n          \"FWD\",\n          \"TAN\"\n        ],\n        \"script_section\": \"Seventeen nine nine five for this twenty seventeen Honda Accord with smooth automatic transmission!\"\n      },\n      {\n        \"vin\": \"3TYRX5GN1MT006219\",\n        \"year\": \"2021\",\n        \"make\": \"Toyota\",\n        \"model\": \"Tacoma 2WD\",\n        \"price\": \"24995 USD\",\n        \"mileage\": \"46987\",\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/01ca7d74365f66abd32bf0a46ab98533.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91190\",\n        \"features\": [\n          \"Automatic\",\n          \"4X2\",\n          \"SILVER\"\n        ],\n        \"script_section\": \"Twenty-four nine nine five gets you this twenty twenty-one Toyota Tacoma truck!\"\n      },\n      {\n        \"vin\": \"1GTU9DED5LZ182661\",\n        \"year\": \"2020\",\n        \"make\": \"GMC\",\n        \"model\": \"Sierra 1500 4WD\",\n        \"price\": \"34995 USD\",\n        \"mileage\": \"84655\",\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/647932d99ec5fae8e35c9c3095f7d238.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91185\",\n        \"features\": [\n          \"Automatic\",\n          \"4X4\",\n          \"BROWN\"\n        ],\n        \"script_section\": \"Thirty-four nine nine five for this twenty twenty GMC Sierra with powerful four-wheel drive!\"\n      },\n      {\n        \"vin\": \"2C4RC1CG7PR550003\",\n        \"year\": \"2023\",\n        \"make\": \"Chrysler\",\n        \"model\": \"Voyager\",\n        \"price\": \"21995 USD\",\n        \"mileage\": \"70576\",\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/444af671439ef388a2b2859281ddeb1a.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91202\",\n        \"features\": [\n          \"Automatic\",\n          \"FWD\",\n          \"SILVER\"\n        ],\n        \"script_section\": \"Twenty-one nine nine five for this twenty twenty-three Chrysler Voyager with spacious family seating!\"\n      },\n      {\n        \"vin\": \"KL79MPSL1RB092746\",\n        \"year\": \"2024\",\n        \"make\": \"Chevrolet\",\n        \"model\": \"Trailblazer\",\n        \"price\": \"27995 USD\",\n        \"mileage\": \"7859\",\n        \"image_url\": \"https://imageserver.promaxinventory.com/9199/image/583acc01b8bf8e644d864e5ff883d572.jpg\",\n        \"url\": \"https://www.ccrantoul.com/VehicleDetails/9199/91210\",\n        \"features\": [\n          \"Automatic\",\n          \"FWD\",\n          \"RED\"\n        ],\n        \"script_section\": \"Twenty-seven nine nine five gets you this brand new twenty twenty-four Shevra-lay Trailblazer!\"\n      }\n    ],\n    \"system_prompt\": \"You are an expert TikTok car ad copywriter specializing in FAST, PUNCHY, scroll-stopping scripts.\\n\\nCRITICAL TEXT-TO-SPEECH FORMATTING:\\n- Write numbers as words: \\\"twenty-one thousand\\\" not \\\"$21,000\\\"\\n- Write years as words: \\\"twenty twenty-four\\\" not \\\"2024\\\"\\n- Spell out abbreviations: \\\"all-wheel drive\\\" not \\\"AWD\\\"\\n- DO NOT mention mileage - it's displayed on screen\\n\\nBRAND NAME PRONUNCIATIONS:\\n- Hyundai → \\\"Hun-day\\\"\\n- Porsche → \\\"Por-shuh\\\"\\n- Chevrolet → \\\"Shevra-lay\\\"\\n- BMW → \\\"B M W\\\" (with spaces)\\n- Mercedes-Benz → \\\"Mer-say-deez Benz\\\"\\n\\nCOMPLIANCE RULES:\\n- NEVER promise financing approval\\n- Use \\\"financing available for qualified buyers\\\"\\n\\nSCRIPT STRUCTURE FOR SCROLL-STOPPING ADS:\\n1. HOOK (3-5 seconds): ONE punchy sentence that grabs attention\\n2. CARS (4-5 seconds EACH): Price + ONE killer feature per car\\n3. CTA (4-5 seconds): Dealership name + ONE contact method\\n\\nTIMING TARGETS:\\n- Single car ad: 15-18 seconds total\\n- Two car ad: 20-23 seconds total  \\n- Three car ad: 24-27 seconds total\\n\\nSTYLE GUIDE:\\n✅ SHORT sentences (5-8 words max)\\n✅ ONE feature per car (the BEST one)\\n✅ Fast-paced, energetic\\n✅ Price FIRST for each car\\n❌ NO long descriptions\\n❌ NO multiple features per car\\n❌ NO mentioning mileage (it's on screen)\\n\\nOUTPUT FORMAT (JSON):\\n{\\n  \\\"hook\\\": \\\"One punchy sentence (3-5 seconds)\\\",\\n  \\\"cars\\\": [\\n    \\\"Price + one killer feature (4-5 seconds each)\\\"\\n  ],\\n  \\\"cta\\\": \\\"Dealership + contact (4-5 seconds)\\\",\\n  \\\"full_script\\\": \\\"All sections concatenated\\\",\\n  \\\"notes\\\": \\\"Brief creative notes\\\"\\n}\\n\\nCRITICAL:\\n- \\\"cars\\\" array MUST match number of vehicles provided\\n- Each car = separate string in array\\n- Keep it FAST and PUNCHY - no fluff!\",\n    \"user_prompt\": \"Generate a FAST, PUNCHY script for this TikTok car ad:\\n\\nPLATFORM: undefined\\nTHEME: when in rome\\n\\nVEHICLES (5 total):\\n\\n1. 2017 Honda Accord Sedan\\n   Price: $17995 USD\\n   TOP Features: Automatic, FWD, TAN\\n   (Pick the BEST one only)\\n\\n2. 2021 Toyota Tacoma 2WD\\n   Price: $24995 USD\\n   TOP Features: Automatic, 4X2, SILVER\\n   (Pick the BEST one only)\\n\\n3. 2020 GMC Sierra 1500 4WD\\n   Price: $34995 USD\\n   TOP Features: Automatic, 4X4, BROWN\\n   (Pick the BEST one only)\\n\\n4. 2023 Chrysler Voyager\\n   Price: $21995 USD\\n   TOP Features: Automatic, FWD, SILVER\\n   (Pick the BEST one only)\\n\\n5. 2024 Chevrolet Trailblazer\\n   Price: $27995 USD\\n   TOP Features: Automatic, FWD, RED\\n   (Pick the BEST one only)\\n\\nDEALERSHIP:\\nCapitol Car Credit\\nPhone: two one seven, eight nine three, eight two three two\\nAddress: one twenty-five North Century Boulevard, Rantoul\\nWebsite: C C Rantoul dot com\\n\\nREQUIREMENTS:\\n1. Hook: ONE sentence related to theme \\\"when in rome\\\"\\n2. Each car: Price + ONE best feature (4-5 seconds)\\n3. CTA: Include dealership name + ONE contact method (pick best fit)\\n4. DO NOT mention mileage (it's on screen)\\n5. Target length: 24-27 seconds\\n\\nEXAMPLES OF GOOD CAR DESCRIPTIONS:\\n✅ \\\"Fifty-four thousand for this twenty twenty-four Genesis GV-seventy with luxurious leather seating!\\\"\\n✅ \\\"Just fourteen nine nine five for this Jeep Compass with all-wheel drive!\\\"\\n✅ \\\"Thirty-four thousand gets you this gorgeous Camry with factory warranty!\\\"\\n\\nBAD (too long):\\n❌ \\\"Check out this amazing twenty twenty-four Genesis for fifty-four thousand, it has leather seats, navigation, and low mileage of eighteen thousand miles\\\"\\n\\nOUTPUT AS JSON:\\n{\\n  \\\"hook\\\": \\\"ONE punchy sentence here\\\",\\n  \\\"cars\\\": [\\n    \\\"2017 Honda description (4-5 sec)\\\",\\n    \\\"2021 Toyota description (4-5 sec)\\\",\\n    \\\"2020 GMC description (4-5 sec)\\\",\\n    \\\"2023 Chrysler description (4-5 sec)\\\",\\n    \\\"2024 Chevrolet description (4-5 sec)\\\"\\n  ],\\n  \\\"cta\\\": \\\"Call to action here\\\",\\n  \\\"full_script\\\": \\\"hook + all cars + cta\\\",\\n  \\\"notes\\\": \\\"Your notes\\\"\\n}\\n\\nRemember: FAST, PUNCHY, ONE feature per car, NO mileage!\",\n    \"metadata\": {\n      \"template_id\": \"TEMP_002\",\n      \"theme\": \"when in rome\",\n      \"vehicle_count\": 5\n    },\n    \"script\": {\n      \"hook\": \"When in Rome, drive like royalty!\",\n      \"cars\": [\n        \"Seventeen nine nine five for this twenty seventeen Honda Accord with smooth automatic transmission!\",\n        \"Twenty-four nine nine five gets you this twenty twenty-one Toyota Tacoma truck!\",\n        \"Thirty-four nine nine five for this twenty twenty GMC Sierra with powerful four-wheel drive!\",\n        \"Twenty-one nine nine five for this twenty twenty-three Chrysler Voyager with spacious family seating!\",\n        \"Twenty-seven nine nine five gets you this brand new twenty twenty-four Shevra-lay Trailblazer!\"\n      ],\n      \"cta\": \"Capitol Car Credit! Call two one seven, eight nine three, eight two three two!\",\n      \"full_script\": \"When in Rome, drive like royalty! Seventeen nine nine five for this twenty seventeen Honda Accord with smooth automatic transmission! Twenty-four nine nine five gets you this twenty twenty-one Toyota Tacoma truck! Thirty-four nine nine five for this twenty twenty GMC Sierra with powerful four-wheel drive! Twenty-one nine nine five for this twenty twenty-three Chrysler Voyager with spacious family seating! Twenty-seven nine nine five gets you this brand new twenty twenty-four Shevra-lay Trailblazer! Capitol Car Credit! Call two one seven, eight nine three, eight two three two!\",\n      \"notes\": \"Rome theme connects luxury/royalty with car ownership. Selected best features: Accord's reliability via automatic, Tacoma's truck utility, Sierra's 4WD capability, Voyager's family space, Trailblazer's newness. Fast-paced with clear pricing structure.\"\n    }\n  }\n",
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1744,
        224
      ],
      "id": "1862884a-3172-49e7-9806-93e63d5a34af",
      "name": "stubs",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.anthropic.com/v1/messages",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "anthropicApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "anthropic-version",
              "value": "2023-06-01"
            }
          ]
        },
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={{ $json._claude_body }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -1296,
        144
      ],
      "id": "f2975c99-9cca-4767-a16d-7255af874873",
      "name": "Call Cloude for Animation Prompt",
      "credentials": {
        "anthropicApi": {
          "id": "zeHBwJZlhd7vKOA9",
          "name": "Anthropic account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all config\nconst config = $input.first().json;\n\n// Parse Claude's response\nlet animationPrompt = config.animation_prompt.trim();\n\n// Remove any markdown formatting\nanimationPrompt = animationPrompt.replace(/```.*?```/gs, '').trim();\nanimationPrompt = animationPrompt.replace(/^[\"']|[\"']$/g, '').trim();\n\n// ENFORCE 480 character limit (Magic Hour's max is 500)\nif (animationPrompt.length > 480) {\n  animationPrompt = animationPrompt.substring(0, 480).trim();\n  const lastSpace = animationPrompt.lastIndexOf(' ');\n  if (lastSpace > 400) {\n    animationPrompt = animationPrompt.substring(0, lastSpace);\n  }\n}\n\nconsole.log('Animation prompt length:', animationPrompt.length);\nconsole.log('Animation prompt:', animationPrompt);\n\n// ALWAYS return full config + new fields\nreturn [{\n  json: {\n    ...config,  // ✅ Pass through ALL config\n    animation_prompt: animationPrompt\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -640,
        224
      ],
      "id": "4639531d-249a-4683-b602-00d017fc1d0c",
      "name": "Parse Animation Prompt"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.magichour.ai/v1/ai-gif-generator",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json._magic_hour_body }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -192,
        288
      ],
      "id": "3eae84e8-061a-4a46-98c1-8bce53f3d035",
      "name": "Generate Magic Hour Animation",
      "credentials": {
        "httpHeaderAuth": {
          "id": "JqCEqmwxTMJ5cZ8Z",
          "name": "Magic Hour API"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.magichour.ai/v1/image-projects/{{ $json.id }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        32,
        288
      ],
      "id": "58462183-7540-421d-82cf-4355f1e07434",
      "name": "Check Magic Hour Status",
      "credentials": {
        "httpHeaderAuth": {
          "id": "JqCEqmwxTMJ5cZ8Z",
          "name": "Magic Hour API"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Get all config\nconst config = $input.first().json;\n\n// Extract the animation URL from Magic Hour response\nconst animationUrl = config.downloads && config.downloads[0] \n  ? config.downloads[0].url \n  : null;\n\nconsole.log('Animation URL:', animationUrl);\nconsole.log('Returning config with keys:', Object.keys(config));\n\n// ALWAYS return full config + new fields\nreturn [{\n  json: {\n    ...config,  // ✅ Pass through ALL config (template_id, theme, vins, avatar, email, etc.)\n    theme_animation_url: animationUrl,\n    _animation_metadata: {\n      magic_hour_id: config.id,\n      created_at: config.created_at,\n      credits_charged: config.credits_charged\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        912,
        96
      ],
      "id": "7f44c306-8059-4bf0-93ea-6ea1f8277957",
      "name": "Add Animation to Config"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -864,
        224
      ],
      "id": "471b77f6-1cc3-4f78-ba18-52be79aa19ec",
      "name": "Merge"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineByPosition",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        688,
        96
      ],
      "id": "74a12af9-b65d-469e-a127-c1587558bc24",
      "name": "Merge1"
    },
    {
      "parameters": {
        "jsCode": "// Get all config\nconst config = $input.first().json;\nconst animationPrompt = config.animation_prompt;\nconst theme = config.theme;\n\n// Build Magic Hour API request body\nconst magicHourBody = {\n  style: {\n    prompt: animationPrompt\n  },\n  name: `${theme.replace(/[^a-zA-Z0-9]/g, '-')}-${Date.now()}`,\n  output_format: \"mp4\"\n};\n\nconsole.log('Magic Hour request body:', JSON.stringify(magicHourBody, null, 2));\nconsole.log('Prompt length:', animationPrompt.length);\n\n// ALWAYS return full config + new fields\nreturn [{\n  json: {\n    ...config,  // ✅ Pass through ALL config\n    _magic_hour_body: magicHourBody\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -416,
        224
      ],
      "id": "1729d5d2-9875-4058-a490-2382c21c564d",
      "name": "Build Magic Hour Request"
    },
    {
      "parameters": {
        "jsCode": "// Extract Animation Prompt from Claude Response\nconst claudeResponse = $json.content[0].text;\n\n// Clean up any markdown\nlet animationPrompt = claudeResponse\n  .replace(/```.*?```/gs, '')\n  .replace(/^[\"']|[\"']$/g, '')\n  .trim();\n\nconsole.log('Extracted animation prompt:', animationPrompt);\n\nreturn [{\n  json: {\n    animation_prompt: animationPrompt\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1088,
        144
      ],
      "id": "0554a43b-fd02-46ca-b2f8-04f03944dbe2",
      "name": "Extract Animation Prompt from Claude"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4ba3d0ac-d612-4c3c-905b-ca85a85ef9ba",
              "leftValue": "={{ $json.status }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        464,
        320
      ],
      "id": "a51f1d7c-912b-4346-bc51-22159381031c",
      "name": "If"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3eb0e679-42b0-4aa4-a1db-dc6e8f8e31f6",
              "name": "error_message",
              "value": "={{ $json.error.message }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        688,
        272
      ],
      "id": "79939bc8-1145-4152-bc89-c2b6950e2fe0",
      "name": "Error message"
    }
  ],
  "connections": {
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "stubs",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Claude Prompt": {
      "main": [
        [
          {
            "node": "Call Cloude for Animation Prompt",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Is Generation Complete?": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait for Generation": {
      "main": [
        [
          {
            "node": "Check Magic Hour Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "stubs": {
      "main": [
        [
          {
            "node": "Build Claude Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Cloude for Animation Prompt": {
      "main": [
        [
          {
            "node": "Extract Animation Prompt from Claude",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Animation Prompt": {
      "main": [
        [
          {
            "node": "Build Magic Hour Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Magic Hour Animation": {
      "main": [
        [
          {
            "node": "Check Magic Hour Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Magic Hour Status": {
      "main": [
        [
          {
            "node": "Is Generation Complete?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Parse Animation Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Add Animation to Config",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Build Magic Hour Request": {
      "main": [
        [
          {
            "node": "Generate Magic Hour Animation",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Extract Animation Prompt from Claude": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Error message",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait for Generation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "1e376e09-fee3-4e64-a31c-4282c09feed3",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-10-20T22:00:45.576Z",
      "createdAt": "2025-10-20T22:00:45.576Z",
      "role": "workflow:owner",
      "workflowId": "xiFggR9H62Zqs4HU",
      "projectId": "bll44iFOa92qb20Q"
    }
  ],
  "tags": [
    {
      "updatedAt": "2025-10-25T13:09:41.651Z",
      "createdAt": "2025-10-25T13:09:41.651Z",
      "id": "9eKfZuV575vaiKME",
      "name": "NOT IN USE"
    }
  ]
}